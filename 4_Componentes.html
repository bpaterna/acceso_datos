
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Begoña Paterna">
      
      
        <link rel="canonical" href="https://bpaterna.github.io/acceso_datos/4_Componentes.html">
      
      
        <link rel="prev" href="3_BD_documentales.html">
      
      
        <link rel="next" href="AWSlab.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Componentes - Acceso a datos</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unidad-4-componentes-spring-framework" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="index.html" title="Acceso a datos" class="md-header__button md-logo" aria-label="Acceso a datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Acceso a datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Componentes
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Acceso a datos" class="md-nav__button md-logo" aria-label="Acceso a datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Acceso a datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Presentación
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Contenido
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contenido
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_BD_relacionales.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acceso a BD relacionales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_BD_documentales.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acceso a BD documentales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Componentes
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="4_Componentes.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Componentes
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Introducción
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2. Spring Boot
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-spring-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3. Spring MVC
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-spring-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4. Spring Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.4. Spring Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-spring-data-jpa-bd-relacionales" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4.1. Spring Data JPA (BD relacionales)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Material adicional
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Material adicional
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AWSlab.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Learner Lab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="db_browser_sqlite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DB Browser SQLite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dbeaver.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DBeaver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mongo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MongoDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="unidad-4-componentes-spring-framework">Unidad 4. Componentes (Spring Framework)<a class="headerlink" href="#unidad-4-componentes-spring-framework" title="Permanent link">&para;</a></h1>
<p><span class="mi_h3">Revisiones</span></p>
<table>
<thead>
<tr>
<th>Revisión</th>
<th>Fecha</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>30-12-2025</td>
<td>Adaptación de los materiales a markdown</td>
</tr>
</tbody>
</table>
<h2 id="41-introduccion">4.1. Introducción<a class="headerlink" href="#41-introduccion" title="Permanent link">&para;</a></h2>
<p>Spring es un framework de código abierto para crear aplicaciones en Java o Kotlin de forma más fácil, rápida y ordenada. Facilita el trabajo de crear objetos, conectar clases, preparar la base de datos y configurar servidores. </p>
<p>Spring se basa principalmente en:</p>
<ul>
<li>
<p><strong>Inversión de Control (IoC):</strong> Se encarga de crear y gestionar los objetos de la aplicación.</p>
</li>
<li>
<p><strong>Inyección de Dependencias (DI):</strong> Coloca los objetos donde hacen falta automáticamente.</p>
</li>
</ul>
<p>Además tiene tres pilares:</p>
<p><strong>1. Autoconfiguración (Spring Boot): prepara el proyecto por ti</strong></p>
<ul>
<li>
<p>Servidor web.</p>
</li>
<li>
<p>Conexión a base de datos.</p>
</li>
<li>
<p>Estructura de proyecto.</p>
</li>
<li>
<p>Dependencias necesarias.</p>
</li>
</ul>
<p><strong>2. Starters: paquetes listos para usar según lo que quieras hacer</strong></p>
<table>
<thead>
<tr>
<th>Starter</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>spring-boot-starter-web</td>
<td>para rutas y controladores</td>
</tr>
<tr>
<td>spring-boot-starter-thymeleaf</td>
<td>para páginas HTML</td>
</tr>
<tr>
<td>spring-boot-starter-data-jpa</td>
<td>para BD y CRUD</td>
</tr>
</tbody>
</table>
<p><strong>3. Anotaciones: indican qué hace cada clase</strong></p>
<p>Las anotaciones son etiquetas especiales que se colocan encima de clases, funciones o atributos para decirle a Spring cómo debe comportarse con ese código. Las anotaciones son, por tanto, la forma en la que Spring entiende la aplicación. Spring tiene muchísimas anotaciones, porque es un framework muy grande y sirve para muchos tipos de proyectos (web MVC, microservicios, seguridad, batch, mensajería, etc.).</p>
<p>En nuestro caso, como vamos a trabajar únicamente con Spring Boot, API REST, vistas HTML y JPA, no es necesario aprender todas las anotaciones que ofrece Spring. Basta con conocer un conjunto reducido de anotaciones básicas, suficientes para desarrollar un backend completo y funcional.</p>
<p>En las siguientes tablas se recogen las anotaciones más importantes que utilizaremos a lo largo del tema (para API REST/vistas HTML + JPA) (a medida que avancemos, irán apareciendo otras anotaciones adicionales que se introducirán solo cuando sean necesarias para la aplicación): </p>
<ul>
<li>Anotaciones de arranque de la app</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@SpringBootApplication</td>
<td>Clase principal</td>
<td>Marca la clase de arranque de la aplicación Spring Boot y activa la auto-configuración y el escaneo de componentes</td>
</tr>
</tbody>
</table>
<ul>
<li>Anotaciones API REST</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@RestController</td>
<td>Clase</td>
<td>Indica que la clase es un controlador REST y que los métodos devuelven directamente datos (normalmente JSON).</td>
</tr>
<tr>
<td>@RequestMapping</td>
<td>Clase o método</td>
<td>Define la ruta base o una ruta concreta para acceder a un recurso</td>
</tr>
<tr>
<td>@GetMapping</td>
<td>Método</td>
<td>Atiende peticiones HTTP <strong>GET</strong> (lectura de datos)</td>
</tr>
<tr>
<td>@PostMapping</td>
<td>Método</td>
<td>Atiende peticiones HTTP <strong>POST</strong> (creación de datos)</td>
</tr>
<tr>
<td>@PutMapping</td>
<td>Método</td>
<td>Atiende peticiones HTTP <strong>PUT</strong> (actualización de datos)</td>
</tr>
<tr>
<td>@DeleteMapping</td>
<td>Método</td>
<td>Atiende peticiones HTTP <strong>DELETE</strong> (eliminación de datos)</td>
</tr>
<tr>
<td>@RequestBody</td>
<td>Parámetro</td>
<td>Permite recibir datos enviados en el cuerpo de la petición (JSON)</td>
</tr>
<tr>
<td>@PathVariable</td>
<td>Parámetro</td>
<td>Permite recoger valores de la URL (por ejemplo, un identificador)</td>
</tr>
</tbody>
</table>
<ul>
<li>Anotaciones MVC (vistas)</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Controller</td>
<td>Clase</td>
<td>Marca una clase como controlador MVC tradicional, devolviendo vistas (HTML con Thymeleaf)</td>
</tr>
</tbody>
</table>
<ul>
<li>Anotaciones de lógica de negocio</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Service</td>
<td>Clase</td>
<td>Marca una clase como servicio, donde se implementa la lógica de negocio</td>
</tr>
<tr>
<td>@Autowired</td>
<td>Atributo o constructor</td>
<td>Inyecta automáticamente una dependencia gestionada por Spring</td>
</tr>
</tbody>
</table>
<ul>
<li>Anotaciones JPA / Base de datos</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Entity</td>
<td>Clase</td>
<td>Indica que la clase representa una tabla de la base de datos</td>
</tr>
<tr>
<td>@Table</td>
<td>Clase</td>
<td>Define el nombre de la tabla asociada a la entidad</td>
</tr>
<tr>
<td>@Id</td>
<td>Atributo</td>
<td>Marca el atributo como clave primaria</td>
</tr>
<tr>
<td>@GeneratedValue</td>
<td>Atributo</td>
<td>Indica que el valor de la clave primaria se genera automáticamente</td>
</tr>
<tr>
<td>@Column</td>
<td>Atributo</td>
<td>Configura una columna de la tabla (nombre, restricciones, unicidad, etc.)</td>
</tr>
<tr>
<td>@OneToMany</td>
<td>Atributo</td>
<td>Define una relación uno-a-muchos entre entidades</td>
</tr>
<tr>
<td>@ManyToOne</td>
<td>Atributo</td>
<td>Define una relación muchos-a-uno entre entidades</td>
</tr>
<tr>
<td>@JoinColumn</td>
<td>Atributo</td>
<td>Especifica la columna usada como clave foránea en una relación</td>
</tr>
</tbody>
</table>
<ul>
<li>Anotaciones de acceso a datos</li>
</ul>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Dónde se usa</th>
<th>Para qué sirve</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Repository</td>
<td>Clase o interfaz</td>
<td>Indica que la clase o interfaz se encarga del acceso a datos y de la gestión de excepciones de base de datos</td>
</tr>
</tbody>
</table>
<p>Los componentes principales de Spring Framework son:</p>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spring Core</td>
<td>El núcleo del framework, encargado de la inyección de dependencias</td>
</tr>
<tr>
<td>Spring Boot</td>
<td>Facilita la creación de aplicaciones basadas en Spring con una configuración mínima</td>
</tr>
<tr>
<td>Spring MVC</td>
<td>Permite el desarrollo de aplicaciones web utilizando el patrón Modelo-Vista-Controlador</td>
</tr>
<tr>
<td>Spring Data</td>
<td>Simplifica el acceso a datos con soporte para JPA, MongoDB, Redis, entre otros</td>
</tr>
<tr>
<td>Spring Security</td>
<td>Proporciona herramientas para implementar seguridad en aplicaciones</td>
</tr>
<tr>
<td>Spring Cloud</td>
<td>Ayuda en la construcción de aplicaciones distribuidas y microservicios</td>
</tr>
</tbody>
</table>
<h2 id="42-spring-boot">4.2. Spring Boot<a class="headerlink" href="#42-spring-boot" title="Permanent link">&para;</a></h2>
<p>Para crear una aplicación se necesita crear el proyecto, desarrollar la aplicación y desplegarla en un servidor. <strong>Spring Boot</strong> simplifica las tareas de crear el proyecto y desplegar la aplicación ya que:</p>
<ul>
<li>
<p>Configura todo automáticamente.</p>
</li>
<li>
<p>Trae un servidor web incorporado (permite crear aplicaciones que se ejecutan de forma independiente sin necesidad de un servidor web externo).</p>
</li>
<li>
<p>Evita escribir XML.</p>
</li>
<li>
<p>Permite arrancar una app con un botón.</p>
</li>
<li>
<p>Usa starters (dependencias ya preparadas).</p>
</li>
<li>
<p>Permite crear proyectos en segundos.</p>
</li>
</ul>
<p>Para crear un proyecto <strong>Spring Boot</strong> Maven/Gradle con las dependencias necesarias tenemos dos opciones:</p>
<ul>
<li>
<p>Crear un proyecto Spring Boot utilizando la herramienta Spring Initializr desde la url <a href="https://start.spring.io/">https://start.spring.io/</a> la cual genera un proyecto base con la estructura de una aplicación Spring Boot en un archivo .zip que podemos abrir directamente desde un IDE.</p>
</li>
<li>
<p>Crear un proyecto Spring Boot utilizando un IDE que tenga instalados los plugins necesarios. En el caso de IntelliJ solamente es posible utilizar el plugin de Spring en la versión Ultimate.</p>
</li>
</ul>
<p>Una vez creado el proyecto tendremos las configuraciones y dependencias en los archivos siguientes:</p>
<ul>
<li>
<p><strong>application.properties:</strong> configuración de aspectos como las conexiones a base de datos o el puerto por donde acceder a nuestra aplicación.</p>
</li>
<li>
<p><strong>pom.xml:</strong> dependencias necesarias para que la aplicación funcione.</p>
</li>
</ul>
<p><strong>Dependencia Spring Web</strong></p>
<ul>
<li>
<p>Se utiliza para desarrollar aplicaciones web, ya sea basadas en REST o tradicionales con HTML dinámico.</p>
</li>
<li>
<p>Incluye un servidor web embebido (por defecto, Tomcat) para ejecutar la aplicación sin necesidad de configurarlo manualmente.</p>
</li>
<li>
<p>Facilita el manejo de rutas HTTP (GET, POST, PUT, DELETE, etc.) y parámetros de solicitud a través de métodos en los controladores.</p>
</li>
<li>
<p>Usa la biblioteca Jackson (incluida por defecto) para convertir automáticamente objetos Kotlin/Java a JSON y viceversa.</p>
</li>
<li>
<p>Ofrece herramientas para manejar errores y excepciones de forma global mediante @ControllerAdvice o controladores personalizados.</p>
</li>
</ul>
<p><span class="mis_ejemplos">Ejemplo 1: Aplicación Spring Boot con Spring Web</span></p>
<p>A continuación se describen los pasos para a crear una aplicación que saluda al usuario utilizando Spring Web.</p>
<p><span class="mi_sombreado"><strong>PASO 1: Crear el proyecto</strong></span></p>
<p>Accedemos a Spring Initializr desde la url <a href="https://start.spring.io/">https://start.spring.io/</a>, indicamos el nombre de la aplicación y añadimos la dependencia <strong>Spring Web</strong> (el resto de opciones las podemos dejar como se ve en la imagen). Por último hacemos clic en el botón GENERATE. Esto hará que se cree el proyecto y se descargue en un archivo .zip. </p>
<p><img alt="Spring 1" src="img/spring/spring01.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 2: Abrir el proyecto y ejecutarlo</strong></span></p>
<p>Descomprimimos el archivo obtenido en el paso anterior y lo abrimos con IntelliJ. Vemos que, además de los archivos <strong>application.properties</strong> y <strong>pom.xml</strong> se ha creado automaticamente la clase <strong>SaludoApplication</strong> (con la anotación <strong>@SpringBootApplication</strong>) y la función de extensión <strong>runApplication</strong> que sirve para lanzar la aplicación.</p>
<p><img alt="Spring 2" src="img/spring/spring02.jpg" /></p>
<p>Por tanto deberemos ejecutar la aplicación usando la clase <code>SaludoApplication.kt</code> como clase principal. Al ejecutar la aplicación veremos por Consola la salida de los mensajes de registro de Spring.</p>
<p><img alt="Spring 3" src="img/spring/spring03.jpg" /></p>
<div class="admonition note">
<p>Si el puerto 8080 está ocupado aparecerá un mensaje diciendo que no se puede iniciar el servidor Tomcat. Puedes cambiar el puerto, por ejemplo al 8888, añadiendo la siguiente línea en el archivo <code>application.properties</code> (que se encuentra en la carpeta resources del proyecto):
<div class="highlight"><pre><span></span><code>server.port=8888
</code></pre></div></p>
</div>
<p><span class="mi_sombreado"><strong>PASO 3: Añadir el código para saludar</strong></span></p>
<p>Añadimos a la clase principal <code>SaludoApplication</code> la función <code>sayHello()</code> con el código necesario para que nuestra aplicación envíe un saludo:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@RestController</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SaludoApplication</span><span class="p">{</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sayHello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;myName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello </span><span class="si">$</span><span class="n">name</span><span class="s">!&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Como puedes ver, se han incluido anotaciones e importaciones, a continuación se explica cada una de ellas:</p>
<ul>
<li>
<p><strong>@RestController</strong>: se utiliza para que Spring reconozca la clase como un controlador que maneja solicitudes HTTP. Combina:</p>
<ul>
<li>@Controller: Define la clase como un controlador web.</li>
<li>@ResponseBody: Indica que los métodos devolverán directamente el cuerpo de la respuesta (en este caso, texto plano en lugar de una vista HTML).</li>
</ul>
</li>
<li>
<p><strong>@GetMapping("/hello")</strong>: Es una anotación de Spring que indica que este método debe manejar las solicitudes HTTP GET que lleguen a la URL /hello.</p>
<ul>
<li>Enlaza la URL /hello con el método sayHello.</li>
<li>Cada vez que se acceda a la ruta <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> (asumiendo el puerto predeterminado 8080) en un navegador con un método GET, Spring ejecutará el método <code>sayHello</code>.</li>
</ul>
</li>
<li>
<p><strong>@RequestParam</strong>: se usa para extraer un parámetro de la consulta (query parameter) enviado en la URL.</p>
<ul>
<li>El método espera un parámetro de consulta llamado <code>myName</code>.</li>
<li>Si el cliente no incluye myName en la solicitud, el valor predeterminado será "World", gracias a defaultValue = "World".</li>
</ul>
</li>
</ul>
<p><span class="mi_sombreado"><strong>PASO 4: Volvemos a ejecutar la aplicación</strong></span></p>
<p>Ejecutamos la aplicación para levantar el servidor y abrimos la dirección <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> o <a href="http://localhost:8080/hello?myName=Atenea">http://localhost:8080/hello?myName=Atenea</a> en el navegador web. La aplicación responde con <code>Hello World!</code> o con <code>Hello Atenea!</code> (que es el nombre pasado como parámetro): </p>
<p><img alt="Spring 4" src="img/spring/spring04.jpg" /></p>
<p><img alt="Spring 5" src="img/spring/spring05.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 5: Entender el funcionamiento</strong></span></p>
<p>Spring Boot está configurado para servir automáticamente cualquier archivo colocado en:</p>
<ul>
<li>
<p>static/</p>
</li>
<li>
<p>public/</p>
</li>
<li>
<p>resources/</p>
</li>
<li>
<p>META-INF/resources/</p>
</li>
</ul>
<p>Esto significa que al poner un archivo estático ahí:</p>
<ul>
<li>
<p>el servidor embebido (Tomcat) lo devuelve tal cual.</p>
</li>
<li>
<p>no pasa por ningún controlador.</p>
</li>
<li>
<p>no necesita anotaciones.</p>
</li>
<li>
<p>no tienes que hacer un @GetMapping.  </p>
</li>
</ul>
<p>Los pasos que sigue la ejecución de la aplicación son los siguientes:</p>
<ul>
<li>
<p><strong>Inicio de la aplicación:</strong> Se ejecuta el método main, lo que inicia un servidor web embebido (por defecto, <code>Tomcat</code>) en el puerto 8080.</p>
</li>
<li>
<p><strong>Solicitudes HTTP:</strong>  En nuestro caso la aplicación solamente está disponible en <code>/hello</code> y cuando un cliente envía una <code>solicitud GET</code> a <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> (con o sin el parámetro <code>myName</code>), el método <code>sayHello</code> maneja la solicitud. <a href="http://localhost:8080">http://localhost:8080</a> dará error porque no hay ningún recurso raíz definido.</p>
</li>
<li>
<p><strong>Respuesta:</strong>  La aplicación devuelve un mensaje personalizado en texto plano según el parámetro <code>myName</code>.</p>
</li>
</ul>
<p><span class="mi_sombreado"><strong>PASO 6: Añadir una página de inicio HTML</strong></span></p>
<p>Creamos el archivo <code>index.html</code> en <code>src/main/resources/static/</code> y sustituimos su contenido por:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Saludo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/hello&quot;</span><span class="p">&gt;</span>Link a saludar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/hello&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;GET&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;nameForm&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;nameField&quot;</span><span class="p">&gt;</span>Indica tu nombre<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;myName&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;nameField&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Saludar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>Ahora la aplicación ya se ejecutará en <a href="http://localhost:8080/">http://localhost:8080/</a> y servirá index.html como recurso raíz.</p>
<p><img alt="Spring 6" src="img/spring/spring06.jpg" /></p>
<div class="admonition success">
<p class="admonition-title">Prueba y analiza el ejemplo 1</p>
<ol>
<li>Crea un proyecto Spring Boot llamado <code>saludo</code> utilizando Spring Initializr. </li>
<li>Prueba el código del ejemplo, verifica que funciona correctamente y pregunta tus dudas.</li>
<li>Modifica el archivo <code>index.html</code> utilizando css para que tenga una apariencia distinta a la del ejemplo.</li>
</ol>
</div>
<h2 id="43-spring-mvc">4.3. Spring MVC<a class="headerlink" href="#43-spring-mvc" title="Permanent link">&para;</a></h2>
<p><strong>Spring MVC</strong> es el módulo de Spring orientado al desarrollo de aplicaciones web siguiendo el patrón <strong>Modelo‑Vista‑Controlador (MVC)</strong>, el cual organiza una aplicación en tres <strong>componentes principales</strong>:</p>
<ul>
<li>
<p><strong>Modelo</strong>: Son los datos. Es responsable de:</p>
<ul>
<li>
<p>Gestionar el estado de la aplicación.</p>
</li>
<li>
<p>Interactuar con la base de datos u otros servicios para obtener y procesar datos.</p>
</li>
<li>
<p>Proveer datos a la vista.</p>
</li>
</ul>
</li>
<li>
<p><strong>Vista</strong>: Es lo que ve el usuario. Es responsable de:</p>
<ul>
<li>
<p>Renderizar información en un formato adecuado, como HTML.</p>
</li>
<li>
<p>Mostrar al usuario los resultados de las acciones ejecutadas.</p>
</li>
</ul>
</li>
<li>
<p><strong>Controlador</strong>: Actúa como intermediario entre el modelo y la vista. Es responsable de:</p>
<ul>
<li>
<p>Procesar las solicitudes del usuario (peticiones HTTP).</p>
</li>
<li>
<p>Interactuar con el modelo para obtener o modificar datos.</p>
</li>
<li>
<p>Seleccionar y devolver la vista adecuada para responder al usuario.</p>
</li>
</ul>
</li>
</ul>
<p>Estos tres componentes trabajan de la siguiente forma:</p>
<p>1) El usuario interactúa con la <strong>Vista</strong> (interfaz). Envia un formulario o hace clic en un enlace.</p>
<p>2) La petición es enviada al <strong>Controlador</strong>.</p>
<p>3) El <strong>Controlador</strong> procesa la petición, interactúa con el <strong>Modelo</strong> si es necesario y selecciona la <strong>Vista</strong> que debe renderizar la respuesta.</p>
<p>4) La <strong>Vista</strong> presenta la respuesta al usuario.</p>
<p><img alt="MCV1" src="img/MVC1.png" /></p>
<p>Spring MVC forma parte del ecosistema Spring y se organiza siguiendo una arquitectura en capas en la que cada capa tiene una función concreta y se comunica únicamente con las capas adyacentes. Esta arquitectura encaja perfectamente con el patrón MVC (Model–View–Controller) y proporciona toda la infraestructura necesaria para manejar peticiones HTTP, invocar controladores y devolver vistas (HTML, JSON, etc.) lo que permite aplicaciones más mantenibles, escalables y fáciles de entender.  </p>
<p>En la siguiente tabla se muestran las capas más habituales en una aplicación Spring con su equivalencia en Spring MVC, sus anotaciones más habituales y la función que realiza cada una de ellas:</p>
<p><strong>Anotaciones por capa y correspondencia Spring ↔ MVC</strong></p>
<table>
<thead>
<tr>
<th>Capas Spring</th>
<th>Capa MVC</th>
<th>Anotaciones</th>
<th>Función</th>
</tr>
</thead>
<tbody>
<tr>
<td>Controller (Web)</td>
<td>Controller</td>
<td><code>@Controller</code><br><code>@RestController</code><br><code>@RequestMapping</code><br><code>@GetMapping</code><br> <code>@RequestParam</code> <br> <code>@PostMapping</code><br><code>@PutMapping</code><br><code>@DeleteMapping</code></td>
<td>Recibe peticiones HTTP, gestiona rutas y parámetros, llama a la capa Service y devuelve una vista o una respuesta (JSON)<br><strong>No contiene lógica de negocio ni acceso a datos</strong></td>
</tr>
<tr>
<td>Model (Entidades)<br>Service (Negocio)<br>Repository (Persistencia)</td>
<td>Model</td>
<td><code>@Entity</code>, <code>@Table</code>, <code>@Id</code><br><code>@Service</code>, <code>@Transactional</code><br><code>@Repository</code></td>
<td>Contiene las clases que modelan la información del negocio, aplica reglas y validaciones y accede a la base de datos para realizar operaciones CRUD (manteniendo aislada la BD del resto de la aplicación)</td>
</tr>
<tr>
<td>View (Representación HTML / JSON)</td>
<td>View</td>
<td><em>(sin anotaciones)</em></td>
<td>Representa los datos al usuario:<br>• Archivo HTML con sintaxis específica para contenido dinámico si se utiliza Thymeleaf / JSP   (Ubicación Thymeleaf: <code>src/main/resources/templates/</code>)<br>• Datos en formato JSON / XML en apps REST (si no se utiliza un motor de plantillas). En REST, el JSON actúa como la vista</td>
</tr>
</tbody>
</table>
<p><img alt="MCV1" src="img/MVC2.png" /></p>
<p><strong>Vistas con Thymeleaf</strong></p>
<p>Thymeleaf es un motor de plantillas que permite mezclar HTML con datos dinámicos proporcionados por el controlador en Spring MVC. Utiliza atributos especiales que comienzan con th: para manipular estos datos de forma dinámica. La siguiente tabla muestra los atributos Thymeleaf más comunes:</p>
<table>
<thead>
<tr>
<th><strong>Atributo</strong></th>
<th><strong>Descripción</strong></th>
<th><strong>Ejemplo</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>th:text</code></strong></td>
<td>Rellena el contenido de un elemento HTML con un valor dinámico.</td>
<td><code>&lt;p th:text="${mensaje}"&gt;Texto por defecto&lt;/p&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:each</code></strong></td>
<td>Itera sobre una colección (lista, array, etc.) y genera un nuevo elemento HTML para cada item.</td>
<td><code>&lt;ul&gt;&lt;li th:each="planta : ${plantas}" th:text="${planta.nombre}"&gt;Nombre de la planta&lt;/li&gt;&lt;/ul&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:if</code></strong></td>
<td>Muestra el contenido solo si la condición es verdadera.</td>
<td><code>&lt;p th:if="${hayPlantas}"&gt;Hay plantas registradas&lt;/p&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:unless</code></strong></td>
<td>Muestra el contenido solo si la condición es falsa.</td>
<td><code>&lt;p th:unless="${hayPlantas}"&gt;No hay plantas registradas&lt;/p&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:href</code></strong></td>
<td>Construye enlaces dinámicos para el atributo <code>href</code> de un enlace <code>&lt;a&gt;</code>.</td>
<td><code>&lt;a th:href="@{/planta/{id}(id=${planta.id})}"&gt;Ver detalles&lt;/a&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:src</code></strong></td>
<td>Construye enlaces dinámicos para el atributo <code>src</code> de una imagen <code>&lt;img&gt;</code>.</td>
<td><code>&lt;img th:src="@{/imagenes/{nombreImagen}(nombreImagen=${planta.imagen})}" alt="Imagen de la planta"&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:action</code></strong></td>
<td>Define la URL a la que se enviará un formulario cuando se haga submit.</td>
<td><code>&lt;form th:action="@{/planta/guardar}" method="post"&gt;&lt;button type="submit"&gt;Guardar&lt;/button&gt;&lt;/form&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:object</code></strong></td>
<td>Asocia un objeto del modelo con el formulario, permitiendo vincular automáticamente sus atributos.</td>
<td><code>&lt;form th:object="${planta}" th:action="@{/planta/guardar}" method="post"&gt;...&lt;/form&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:value</code></strong></td>
<td>Rellena el valor de un campo de formulario (<code>input</code>, <code>textarea</code>, etc.) con un valor dinámico.</td>
<td><code>&lt;input type="text" th:value="${planta.nombre}" /&gt;</code></td>
</tr>
<tr>
<td><strong><code>th:field</code></strong></td>
<td>Asocia un campo de formulario con un atributo del modelo de Spring, vincula los datos automáticamente.</td>
<td><code>&lt;input type="text" th:field="*{nombre}" /&gt;</code></td>
</tr>
</tbody>
</table>
<p><span class="mis_ejemplos">Ejemplo 2: Aplicación utilizando Spring MVC y Thymeleaf</span></p>
<p>A continuación se describen los pasos para crear una aplicación que muestra una lista con nombres de planas y junto a cada nombre un enlace que mostrará los detalles de la planta. Desde la pantalla de detalles, se podrá acceder a un formulario para modificar la información de la planta. La estructura del proyecto será la siguiente:</p>
<p><img alt="Spring 9" src="img/spring/spring09.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 1: Crear el proyecto</strong></span></p>
<p>Accedemos a Spring Initializr desde la url <a href="https://start.spring.io/">https://start.spring.io/</a>, indicamos el nombre de la aplicación <code>plantas</code> y, en este caso, además de la dependencia <strong>Spring Web</strong> necesitamos también <strong>Thymeleaf</strong> (el resto de opciones las podemos dejar como se ve en la imagen). Por último hacemos clic en el botón GENERATE para descargar nuestro nuevo proyecto.</p>
<p>Opcionalmente podemos añadir <strong>Spring Boot DevTools</strong> que nos ahorrará tiempo de desarrollo ya que:</p>
<ul>
<li>
<p>Reinicia automáticamente la aplicación cuando cambias código.</p>
</li>
<li>
<p>Recarga las plantillas Thymeleaf sin reiniciar manualmente.</p>
</li>
</ul>
<p>Para tener estas funciones activas, además de añadir la dependencia, hay que configurar IntelliJ para que compile al guardar. Esto se consigue activando las opciones siguientes: </p>
<ul>
<li>
<p>Build project automatically (Settings → Build, Execution, Deployment → Compiler)</p>
</li>
<li>
<p>Allow auto-make to start even if developed application is currently running (Settings → Advanced Settings)</p>
</li>
</ul>
<p>De esta forma, cuando realicemos un cambio en un archivo de código de nuestra aplicación, bastará con guardarlo y recargar el navegador (sin reiniciar la app) para ver los cambios inmediatamente.</p>
<p><img alt="Spring 7" src="img/spring/spring07.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 2: Abrir el proyecto</strong></span></p>
<p>Descomprimimos el archivo obtenido en el paso anterior y abrimos el proyecto con IntelliJ. Comprobamos que la clase principal de la aplicación es <code>PlantasApplication.kt</code>, que se encuentra en la carpeta <code>src/main/kotlin/com/example/plantas/</code> y que contiene el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantas</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.boot.runApplication</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantasApplication</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">runApplication</span><span class="o">&lt;</span><span class="n">PlantasApplication</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 3: Añadir el controlador</strong></span></p>
<p>En este caso, como la aplicación es muy sencilla el controlador maneja las solicitudes al recibir las peticiones HTTP, decide qué datos se usan y devuelve la vista adecuada. Para añadir el controlador, creamos el archivo <code>PlantaController.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantas/controller/</code> con el código siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantas.controller</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantas.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PathVariable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PostMapping</span>


<span class="nd">@Controller</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableListOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">Planta</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Rosa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Flor&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rosa.jpg&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">Planta</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Cactus&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Suculenta&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cactus.jpg&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">Planta</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Orquídea&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Flor&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;orquidea.jpg&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">mostrarPlantas</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;plantas&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plantas</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;plantas&quot;</span><span class="w"> </span><span class="c1">// vista de la lista de plantas (Nombre del archivo HTML en src/main/resources/templates)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Detalles de una planta</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/planta/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">verPlanta</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Buscar la planta por id</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantas</span><span class="p">.</span><span class="na">find</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id_planta</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Comprobamos si existe</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;errorPlanta&quot;</span><span class="w"> </span><span class="c1">// vista de error sencilla</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;detallePlanta&quot;</span><span class="w"> </span><span class="c1">// vista de detalle de una planta</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// formulario para modificar</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/planta/editar/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">editarPlanta</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantas</span><span class="p">.</span><span class="na">find</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id_planta</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;errorPlanta&quot;</span>

<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;editarPlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/planta/guardar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardarCambios</span><span class="p">(</span><span class="n">plantaModificada</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantas</span><span class="p">.</span><span class="na">find</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">planta</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">planta</span><span class="p">.</span><span class="na">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">nombre</span>
<span class="w">            </span><span class="n">planta</span><span class="p">.</span><span class="na">tipo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">tipo</span>
<span class="w">            </span><span class="n">planta</span><span class="p">.</span><span class="na">altura</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">altura</span>
<span class="w">            </span><span class="n">planta</span><span class="p">.</span><span class="na">foto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">foto</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/planta/</span><span class="si">${</span><span class="n">plantaModificada</span><span class="p">.</span><span class="na">id_planta</span><span class="si">}</span><span class="s">&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Explicación del código</strong></p>
<p><code>@Controller</code> Indica a Spring que esta clase maneja peticiones web y devuelve vistas HTML.</p>
<p><code>@GetMapping</code> Muestra páginas HTML</p>
<table>
<thead>
<tr>
<th>Función</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@GetMapping("/plantas")</code></td>
<td>Muestra una lista de todas las plantas en <code>plantas.html</code>.</td>
</tr>
<tr>
<td><code>@GetMapping("/planta/{id_planta}")</code></td>
<td>Muestra información de detalle de una planta específica en <code>detallePlanta.html</code>. Si no existe, muestra <code>errorPlanta.html</code>.</td>
</tr>
<tr>
<td><code>@GetMapping("/planta/editar/{id_planta}")</code></td>
<td>Carga la planta en un formulario de edición <code>editarPlanta.html</code>.</td>
</tr>
</tbody>
</table>
<p><code>@PostMapping</code> Procesa el formulario para editar la información de una planta</p>
<table>
<thead>
<tr>
<th>Función</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@PostMapping("/planta/guardar")</code></td>
<td>Actualiza la planta en memoria y redirige al detalle con <code>redirect:/planta/{id}</code>.  Se utiliza <code>redirect</code> para evitar el reenvío de formularios</td>
</tr>
</tbody>
</table>
<p><code>Model</code> Pasa datos a la vista</p>
<p><code>@PathVariable</code> Lee datos de la URL</p>
<p><span class="mi_sombreado"><strong>PASO 4: Añadir el modelo</strong></span></p>
<p>El modelo representa los datos que maneja la aplicación. Para añadir el modelo creamos el archivo <code>Planta.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantas/model/</code> con el código siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantas.model</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Planta</span><span class="p">(</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">nombre</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">tipo</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">altura</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">foto</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 5: Añadir las vistas con Thymeleaf</strong></span></p>
<p>Para nuestra aplicación necesitamos cuatro vistas, una para la lista de plantas, otra para el detalle de una planta, una tercera para avisar en caso de producirse un error y la última para modificar la información de la planta. Por tanto tendremos cuatro archivos <code>html</code> todos ellos dentro de la carpeta <code>src/main/resources/templates/</code>.</p>
<ul>
<li>El archivo que mostrará la lista de plantas será <code>plantas.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Lista de Plantas<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-4&quot;</span><span class="p">&gt;</span>Plantas<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${plantas.size() &gt; 0}&quot;</span><span class="p">&gt;</span>Aquí tienes una lista de todas las plantas:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:unless</span><span class="o">=</span><span class="s">&quot;${plantas.size() &gt; 0}&quot;</span><span class="p">&gt;</span>No se han encontrado plantas.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;planta : ${plantas}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.id_planta}&quot;</span><span class="p">&gt;</span>Id de la planta<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span> -
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.nombre}&quot;</span><span class="p">&gt;</span>Nombre de la planta<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span> (<span class="p">&lt;</span><span class="nt">label</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.altura}&quot;</span><span class="p">&gt;</span>Altura de la planta<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span> m)

        <span class="cm">&lt;!-- Mostrar enlace a la página de detalles de la planta --&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/planta/{id_planta}(id_planta=${planta.id_planta})}&quot;</span><span class="p">&gt;</span>Ver detalles<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el detalle de una plantas será <code>detallePlanta.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Detalles de la Planta<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Mostrar foto de la planta --&gt;</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/fotos/{nombreImagen}(nombreImagen=${planta.foto})}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Foto de la planta&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 200px;&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.nombre}&quot;</span><span class="p">&gt;</span>Nombre de la planta<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Tipo: &#39; + ${planta.tipo}&quot;</span><span class="p">&gt;</span>Tipo de planta<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Altura: &#39; + ${planta.altura} + &#39; metros&#39;&quot;</span><span class="p">&gt;</span>Altura de la planta<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/planta/editar/{id_planta}(id_planta=${planta.id_planta})}&quot;</span><span class="p">&gt;</span>Modificar planta<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas}&quot;</span><span class="p">&gt;</span>Volver a la lista de plantas<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el aviso en caso de error será <code>errorPlanta.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Planta no encontrada<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Error<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>La planta que estás buscando no existe.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas}&quot;</span><span class="p">&gt;</span>Volver a la lista de plantas<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el formulario para modificar la información de una planta será <code>editarPlanta.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Editar planta<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Modificar planta<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/planta/guardar}&quot;</span>
      <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${planta}&quot;</span>
      <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id_planta}&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Nombre: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{nombre}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Tipo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{tipo}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Altura: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">step</span><span class="o">=</span><span class="s">&quot;0.1&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{altura}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Foto: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{foto}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Guardar cambios<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/planta/{id_planta}(id_planta=${planta.id_planta})}&quot;</span><span class="p">&gt;</span>Volver al detalle<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p><strong>Explicación de las vistas Thymeleaf</strong></p>
<p>Condicionales:</p>
<ul>
<li>
<p>th:if muestra un mensaje si hay plantas registradas.</p>
</li>
<li>
<p>th:unless muestra un mensaje alternativo si no hay plantas.</p>
</li>
</ul>
<p>Iteración sobre la colección:</p>
<ul>
<li>th:each="planta : ${plantas}" recorre la lista de plantas (plantas) y crea un bloque de código html (en este caso el que hay dentro de la etiqueta <code>&lt;p&gt;</code>) para cada planta.</li>
</ul>
<p>Mostrar datos dinámicos:</p>
<ul>
<li>
<p>th:text="${planta.nombre}" muestra el nombre de la planta.</p>
</li>
<li>
<p>th:text="'Tipo: ' + ${planta.tipo}" concatena el texto "Tipo: " con el tipo de la planta.</p>
</li>
<li>
<p>th:text="'Altura: ' + ${planta.altura} + ' metros'" muestra la altura de la planta en metros.</p>
</li>
</ul>
<p>Enlaces dinámicos:</p>
<ul>
<li>th:href="@{/planta/{id_planta}(id_planta=${planta.id_planta})}" genera un enlace a la página de detalles de la planta usando el id_planta de la planta.</li>
</ul>
<p>Imágenes dinámicas:</p>
<ul>
<li>th:src="@{/fotos/{nombreImagen}(nombreImagen=${planta.foto})}" carga foto de la planta.</li>
</ul>
<p>Formulario:</p>
<ul>
<li>
<p>th:action="@{/planta/guardar}" indica la URL a la que se enviarán los datos del formulario cuando se haga submit.</p>
</li>
<li>
<p>th:object="${planta}" asocia un objeto del modelo de Spring (Model) con el formulario. En este caso <code>${planta}</code> hace referencia a la planta que se pasó al modelo desde el controlador: <code>model.addAttribute("planta", planta)</code>. Esto permite usar atributos de planta en los campos del formulario.</p>
</li>
</ul>
<p><span class="mi_sombreado"><strong>PASO 6: Añadir las fotos de las plantas</strong></span></p>
<p>Para poder mostrar las fotos de nuestras plantas en la vista de detalle, hemos guardado las fotos en una carpeta llamada <code>fotos</code> dentro de <code>src/main/resources/static/</code>.</p>
<p><span class="mi_sombreado"><strong>PASO 7: Comprobar y ejecutar</strong></span></p>
<p>Ejecutamos la aplicación usando la clase <code>PlantasApplication.kt</code> como clase principal y abrimos la url <a href="http://localhost:8080/plantas">http://localhost:8080/plantas</a> en el navegador. Las siguientes imágenes muestran el funcionamiento de nuestra aplicación:</p>
<ul>
<li>Lista de plantas:</li>
</ul>
<p><img alt="Spring 10a" src="img/spring/spring10a.jpg" /></p>
<ul>
<li>Detalle de la planta con id_planta = 1 (que aparece al hacer clic en el enlace <code>Ver detalles</code> junto al nombre de la planta):</li>
</ul>
<p><img alt="Spring 10b" src="img/spring/spring10b.jpg" /></p>
<ul>
<li>Error (en este caso por indicar en la url el id_planta de una planta que no existe):</li>
</ul>
<p><img alt="Spring 10c" src="img/spring/spring10c.jpg" /></p>
<ul>
<li>Formulario de edición:</li>
</ul>
<p><img alt="Spring 10d" src="img/spring/spring10d.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 8: Cambiar el aspecto</strong></span></p>
<p>Como hemos visto en las capturas anteriores, nuestas vistas html no tienen aplicado ningún estilo. Vamos a darle a nuestra aplicación un aspecto más profesional utilizando <code>bootstrap</code>. Podemos encontrar mucha documentacion en internet sobre como utilizarlo. Por ejemplo en:</p>
<ul>
<li>
<p><a href="https://getbootstrap.com/docs/5.3/getting-started/introduction/">https://getbootstrap.com/docs/5.3/getting-started/introduction/</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/bootstrap5/">https://www.w3schools.com/bootstrap5/</a></p>
</li>
</ul>
<p>En nuestro caso vamos a descargarlo para incluirlo de forma local en nuestro proyecto y vamos a modificar nuestras vistas <code>html</code> para que lo utilicen. Para ello, seguiremos estos pasos:</p>
<ol>
<li>
<p>Entrar en <a href="https://getbootstrap.com">https://getbootstrap.com</a> </p>
</li>
<li>
<p>Hacer clic en el botón <code>Download</code> y descargar la versión <strong>Compiled CSS and JS</strong></p>
</li>
<li>
<p>Descomprir el ZIP y copiar la carpeta <code>bootstrap</code> en <code>src/main/resources/static/</code></p>
</li>
<li>
<p>Modificar los archivos html para añadir la línea <code>&lt;link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}"&gt;</code> dentro de la etiqueta <code>&lt;head&gt;</code> y añadir <code>&lt;div class="container mt-5"&gt;</code> justo debajo de la etiqueta <code>&lt;body&gt;</code> (no olvides añadir tambien <code>&lt;/div&gt;</code> justo antes de <code>&lt;/body&gt;</code>).</p>
</li>
</ol>
<p>Solamente con estos pequeños cambios nuestra aplicación cambiará su aspecto a:</p>
<ul>
<li>Lista de plantas:</li>
</ul>
<p><img alt="Spring 10a" src="img/spring/spring10a2.jpg" /></p>
<ul>
<li>Detalle de la planta con id_planta = 1 (que aparece al hacer clic en el enlace <code>Ver detalles</code> junto al nombre de la planta):</li>
</ul>
<p><img alt="Spring 10b" src="img/spring/spring10b2.jpg" /></p>
<ul>
<li>Error (en este caso por indicar en la url el id_planta de una planta que no existe):</li>
</ul>
<p><img alt="Spring 10c" src="img/spring/spring10c2.jpg" /></p>
<ul>
<li>Formulario de edición:</li>
</ul>
<p><img alt="Spring 10d" src="img/spring/spring10d2.jpg" /></p>
<div class="admonition success">
<p class="admonition-title">Prueba y analiza el ejemplo 2</p>
<ol>
<li>Crea un proyecto Spring Boot llamado <code>plantas</code> utilizando Spring Initializr.</li>
<li>Prueba el código del ejemplo, verifica que funciona correctamente y pregunta tus dudas.</li>
</ol>
</div>
<p><span class="mi_h3">Trabajando con ficheros</span></p>
<p>En el ejemplo anterior, la información de las plantas se almacenaba en memoria mediante una lista y el controlador accedía directamente a ella. Ahora vamos a trabajar con los datos en un fichero CSV para disponer de persistencia y vamos a separar la responsabilidad de cada capa del patrón MVC de forma que:</p>
<ul>
<li>
<p>Controlador: interactúa con el usuario.</p>
</li>
<li>
<p>Repositorio: maneja los datos.</p>
</li>
<li>
<p>Servicio intermedio: hace de intermediario entre el controlador y el repositorio.</p>
</li>
</ul>
<p><span class="mis_ejemplos">Ejemplo 3: CRUD (CSV) con Spring MVC y Thymeleaf</span></p>
<p>Este ejemplo es un CRUD de información almacenada en un fichero CSV con todas las capas de la arquitectura MVC bien separadas. La estructura del proyecto será la siguiente:</p>
<p><img alt="Spring 11" src="img/spring/spring11.jpg" /></p>
<p>A continuación se describen los pasos necesarios para desarrollar el proyecto:</p>
<p><span class="mi_sombreado"><strong>PASO 1: Crear el proyecto</strong></span></p>
<p>Creamos un nuevo proyecto llamado <code>plantasCSV</code> utilizando Spring Initializr con las mismas dependencias del ejemplo anterior. Si copiamos fragmentos de código del anterior ejemplo habrá que tener cuidado con los imports y cambiar <code>com.example.plantas</code> por <code>com.example.plantasCSV</code></p>
<p><span class="mi_sombreado"><strong>PASO 2: Crear el fichero CSV</strong></span></p>
<p>Creamos un archivo llamado <code>plantas.csv</code> con los datos iniciales y lo ubicamos en la carpeta <code>src/main/resources/data/</code>. Su contenido inicial será:</p>
<div class="highlight"><pre><span></span><code>1;Rosa;Flor;0.5;rosa.jpg
2;Cactus;Suculenta;1.2;cactus.jpg
3;Orquídea;Flor;0.3;orquidea.jpg
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 3: Modificar el controlador</strong></span></p>
<p>En la arquitectura MVC (Modelo-Vista-Controlador), el controlador es el encargado de recibir las peticiones del usuario (cuando hace clic en un enlace o envía un formulario en el navegador) y decidir qué respuesta dar (normalmente, mostrar una página HTML). Vamos a modificar el controlador que teníamos de la aplicación anterior para que solamente interactúe con el usuario y no acceda a los datos. Además añadiremos el código necesario para las funciones de crear nueva planta y borrar una existente. El código es el siguiente: </p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasCSV.controller</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasCSV.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasCSV.service.PlantaService</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span>


<span class="nd">@Controller</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaController</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaService</span><span class="p">:</span><span class="w"> </span><span class="n">PlantaService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listar</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;plantas&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">listarPlantas</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/planta/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">detalle</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">buscarPorId</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span>
<span class="w">            </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;errorPlanta&quot;</span>

<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;detallePlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// CREAR nueva planta</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/nueva&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">nuevaPlanta</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Pasamos un objeto vacío (o con ID 0/null) para el formulario</span>
<span class="w">        </span><span class="c1">// Como tu data class tiene tipos primitivos, pon valores por defecto dummy</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaVacia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Planta</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plantaVacia</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;titulo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nueva Planta&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;formularioPlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// EDITAR planta existente</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/editar/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">editarPlanta</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">buscarPorId</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;titulo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Editar Planta&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;formularioPlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Procesar el GUARDADO (sirve para crear y editar)</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/plantas/guardar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardarPlanta</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">plantaService</span><span class="p">.</span><span class="na">guardar</span><span class="p">(</span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Procesar el BORRADO</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/borrar/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">borrarPlanta</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">plantaService</span><span class="p">.</span><span class="na">borrar</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 4: Añadir la clase que maneja los datos</strong></span></p>
<p>Esta clase se encarga de acceder a los datos y gestionarlos, es decir, leer, crear, actualizar y borrar información sobre plantas. Para añadirla creamos el archivo <code>PlantaFileRepository.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantas/repository/</code> con el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasCSV.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasCSV.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.io.File</span>

<span class="nd">@Repository</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaFileRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;src/main/resources/data/plantas.csv&quot;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">findAll</span><span class="p">():</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">Planta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">File</span><span class="p">(</span><span class="n">filePath</span><span class="p">).</span><span class="na">readLines</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">linea</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">partes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linea</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">Planta</span><span class="p">(</span>
<span class="w">                </span><span class="n">id_planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="p">.</span><span class="na">toInt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="p">,</span>
<span class="w">                </span><span class="n">tipo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="p">,</span>
<span class="w">                </span><span class="n">altura</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="p">.</span><span class="na">toDouble</span><span class="p">(),</span>
<span class="w">                </span><span class="n">foto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">4</span><span class="o">]</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}.</span><span class="na">toMutableList</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findAll</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// Buscamos si la planta ya existe para saber si es EDITAR o CREAR</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantas</span><span class="p">.</span><span class="na">indexOfFirst</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">planta</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// EDITAR: Reemplazamos la planta existente</span>
<span class="w">            </span><span class="n">plantas</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planta</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// CREAR: Calculamos nuevo ID (Simulación de Auto-Increment)</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">nuevoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">plantas</span><span class="p">.</span><span class="na">maxOfOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="c1">// Usamos copy porque los val son inmutables, asignando el nuevo ID</span>
<span class="w">            </span><span class="n">plantas</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">planta</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">id_planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nuevoId</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">escribirArchivo</span><span class="p">(</span><span class="n">plantas</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteById</span><span class="p">(</span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findAll</span><span class="p">()</span>
<span class="w">        </span><span class="n">plantas</span><span class="p">.</span><span class="na">removeIf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id_planta</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">escribirArchivo</span><span class="p">(</span><span class="n">plantas</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">escribirArchivo</span><span class="p">(</span><span class="n">plantas</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Planta</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">contenido</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantas</span><span class="p">.</span><span class="na">joinToString</span><span class="p">(</span><span class="n">separator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">planta</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="s">&quot;</span><span class="si">${</span><span class="n">planta</span><span class="p">.</span><span class="na">id_planta</span><span class="si">}</span><span class="s">;</span><span class="si">${</span><span class="n">planta</span><span class="p">.</span><span class="na">nombre</span><span class="si">}</span><span class="s">;</span><span class="si">${</span><span class="n">planta</span><span class="p">.</span><span class="na">tipo</span><span class="si">}</span><span class="s">;</span><span class="si">${</span><span class="n">planta</span><span class="p">.</span><span class="na">altura</span><span class="si">}</span><span class="s">;</span><span class="si">${</span><span class="n">planta</span><span class="p">.</span><span class="na">foto</span><span class="si">}</span><span class="s">&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">File</span><span class="p">(</span><span class="n">filePath</span><span class="p">).</span><span class="na">writeText</span><span class="p">(</span><span class="n">contenido</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 5: Añadir la clase del servicio intermedio</strong></span></p>
<p>En la arquitectura MVC el servicio actúa como el intermediario entre el controlador (parte que interactúa con el usuario) y el repositorio (parte que maneja los datos). Para añadirla creamos el archivo <code>PlantaService.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantas/service/</code> con el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasCSV.service</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasCSV.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasCSV.repository.PlantaFileRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">repository</span><span class="p">:</span><span class="w"> </span><span class="n">PlantaFileRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listarPlantas</span><span class="p">():</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">Planta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">buscarPorId</span><span class="p">(</span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">Planta? </span><span class="o">=</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">find</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id_planta</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id_planta</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardar</span><span class="p">(</span><span class="n">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">planta</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">borrar</span><span class="p">(</span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 6: Modificar las vistas</strong></span></p>
<p>A los archivos html del ejemplo anterior les hemos hecho algunas modificaciones y ahora quedan así:</p>
<ul>
<li>El archivo que mostrará la lista de plantas será <code>plantas.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Lista de Plantas<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Plantas<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${plantas.size() &gt; 0}&quot;</span><span class="p">&gt;</span>Aquí tienes una tabla con todas las plantas y las acciones que puedes hacer con ellas<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:unless</span><span class="o">=</span><span class="s">&quot;${plantas.size() &gt; 0}&quot;</span><span class="p">&gt;</span>No hay plantas registradas en el sistema<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Nombre<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Tipo<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Acciones<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;planta : ${plantas}&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.id_planta}&quot;</span><span class="p">&gt;</span>1<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.nombre}&quot;</span><span class="p">&gt;</span>Rosa<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.tipo}&quot;</span><span class="p">&gt;</span>Flor<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>

                <span class="cm">&lt;!-- Mostrar enlace a la página de detalles de la planta --&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/planta/{id_planta}(id_planta=${planta.id_planta})}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info  btn-sm&quot;</span><span class="p">&gt;</span>Detalles<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas/editar/{id}(id=${planta.id_planta})}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info  btn-sm&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

                <span class="cm">&lt;!-- En un entorno real, borrar debería ser un form con method POST/DELETE,</span>
<span class="cm">                     pero para aprender, un GET está bien --&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas/borrar/{id}(id=${planta.id_planta})}&quot;</span>
                   <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info btn-sm&quot;</span>
                   <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;return confirm(&#39;¿Estás seguro de borrar esta planta?&#39;)&quot;</span><span class="p">&gt;</span>Borrar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas/nueva}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5&quot;</span><span class="p">&gt;</span>Agregar Nueva Planta<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el detalle de una plantas será <code>detallePlanta.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Detalles de la Planta<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row justify-content-center&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-6 text-center&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 18rem;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card text-center&quot;</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- Foto --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/fotos/{nombreImagen}(nombreImagen=${planta.foto})}&quot;</span>
             <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Foto&quot;</span>
             <span class="na">class</span><span class="o">=</span><span class="s">&quot;img-fluid rounded mb-4&quot;</span>
             <span class="na">style</span><span class="o">=</span><span class="s">&quot;max-height: 250px;&quot;</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title text-info mb-4&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.nombre}&quot;</span><span class="p">&gt;</span>Nombre<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

                <span class="cm">&lt;!-- Datos (usamos fw-bold para negrita) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fs-5&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fw-bold&quot;</span><span class="p">&gt;</span>Tipo:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- Badge para resaltar el tipo --&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.tipo}&quot;</span><span class="p">&gt;</span>Tipo<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fs-5&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fw-bold&quot;</span><span class="p">&gt;</span>Altura:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.altura} + &#39; m&#39;&quot;</span><span class="p">&gt;</span>0.0 m<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">hr</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-4&quot;</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas/editar/{id_planta}(id_planta=${planta.id_planta})}&quot;</span>
               <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info bt-sm&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas/borrar/{id_planta}(id_planta=${planta.id_planta})}&quot;</span>
               <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info bt-sm&quot;</span>
               <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;return confirm(&#39;¿Estás seguro de borrar esta planta?&#39;)&quot;</span><span class="p">&gt;</span>Borrar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-3&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas}&quot;</span><span class="p">&gt;</span>Volver al listado<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el aviso en caso de error será <code>errorPlanta.html</code> y su código es el siguiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Planta no encontrada<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Error<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>La planta que estás buscando no existe.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas}&quot;</span><span class="p">&gt;</span>Volver a la lista de plantas<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>El archivo que mostrará el formulario para añadir una planta o modificar la información de una existenet será <code>formularioPlanta.html</code> y su código es el siguiente:
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${titulo}&quot;</span><span class="p">&gt;</span>Formulario Planta<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${titulo}&quot;</span><span class="p">&gt;</span>Formulario<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/plantas/guardar}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${planta}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>

    <span class="cm">&lt;!-- Campo oculto para el ID. Si es 0 se creará nuevo, si es &gt; 0 se editará --&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id_planta}&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Nombre:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{nombre}&quot;</span> <span class="na">required</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Tipo:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{tipo}&quot;</span> <span class="na">required</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Altura (m):<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">step</span><span class="o">=</span><span class="s">&quot;0.1&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{altura}&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Nombre Foto (ej: rosa.jpg):<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{foto}&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success&quot;</span><span class="p">&gt;</span>Guardar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/plantas}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancelar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></li>
</ul>
<p><span class="mi_sombreado"><strong>PASO 7: Comprobar y ejecutar</strong></span></p>
<p>Ejecutamos la aplicación usando la clase <code>PlantasApplication.kt</code> como clase principal y abrimos la url <a href="http://localhost:8080/plantas">http://localhost:8080/plantas</a> en el navegador. Las siguientes imágenes muestran el funcionamiento de nuestra aplicación:</p>
<ul>
<li>Lista de plantas (en este caso se ha cambiado la lista por una tabla y se han añadido botones de acciones a cada planta):</li>
</ul>
<p><img alt="Spring 12a" src="img/spring/spring12a.jpg" /></p>
<ul>
<li>Detalle de la planta:</li>
</ul>
<p><img alt="Spring 12b" src="img/spring/spring12b.jpg" /></p>
<ul>
<li>Formulario de edición (sirve tanto para añadir una nueva planta como para modificar una ya existente):</li>
</ul>
<p><img alt="Spring 12c" src="img/spring/spring12c.jpg" /></p>
<ul>
<li>Mensaje de confirmación de borrado:</li>
</ul>
<p><img alt="Spring 12d" src="img/spring/spring12d.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 8: Entender el funcionamiento</strong></span></p>
<p>Al ejecutar el programa se produce esta secuencia de acciones:</p>
<ol>
<li>
<p>El <strong>usuario</strong> entra a /plantas.</p>
</li>
<li>
<p>El <strong>controlador</strong> recibe la petición y llama al <strong>servicio (listarPlantas)</strong>.</p>
</li>
<li>
<p>El <strong>servicio</strong> llama al <strong>repositorio (findAll)</strong>.</p>
</li>
<li>
<p>El <strong>repositorio</strong> lee el archivo plantas.csv, convierte el texto en objetos y los devuelve.</p>
</li>
<li>
<p>El <strong>controlador</strong> mete esos objetos en el <strong>modelo</strong> y carga la plantilla HTML plantas.html.</p>
</li>
<li>
<p>El <strong>usuario</strong> lee la información de las plantas en su navegador.</p>
</li>
</ol>
<div class="admonition success">
<p class="admonition-title">Prueba y analiza el ejemplo 3</p>
<ol>
<li>Crea un proyecto Spring Boot llamado <code>plantasCSV</code> utilizando Spring Initializr.</li>
<li>Prueba el código del ejemplo, verifica que funciona correctamente y pregunta tus dudas.</li>
</ol>
</div>
<div class="admonition warning">
<p class="admonition-title">Práctica 1: Trabaja en tu aplicación</p>
<ol>
<li>Crea un nuevo proyecto Spring Boot (con el nombre de tu aplicación) utilizando Spring Initializr.</li>
<li>Tu aplicación tendrá las operaciones CRUD sobre un fichero CSV con la información de tu aplicación.</li>
<li>Modifica el aspecto de las vistas con <code>bootstrap</code> o <code>css</code> propio para que el resultado quede totalmente diferente al del ejemplo.</li>
</ol>
</div>
<h2 id="44-spring-data">4.4. Spring Data<a class="headerlink" href="#44-spring-data" title="Permanent link">&para;</a></h2>
<p>Spring Data proporciona herramientas y abstracciones para facilitar el acceso a bases de datos y otras fuentes de datos de manera <strong>eficiente y consistente</strong>. Su objetivo principal es <strong>simplificar la interacción con diferentes tipos de bases de datos</strong>, tanto <strong>relacionales</strong> (como PostgreSQL o MySQL) como <strong>NoSQL</strong> (por ejemplo MongoDB), reduciendo la cantidad  de código necesario y <strong>unificando la forma de trabajar con los datos</strong>. </p>
<p>Se utiliza para:</p>
<p><strong>1. Acceso Simplificado a Datos:</strong></p>
<ul>
<li>Reduce la necesidad de escribir consultas SQL complejas o código JDBC al exponer métodos predefinidos para operaciones comunes.</li>
<li>Permite realizar operaciones CRUD (Crear, Leer, Actualizar, Eliminar) con facilidad.</li>
</ul>
<p><strong>2. Abstracción de Repositorios:</strong> Ofrece la interfaz <strong>Repository</strong> y subinterfaces como <strong>CrudRepository</strong> y <strong>JpaRepository</strong> que proporcionan métodos estándar para la gestión de entidades en bases de datos relacionales.</p>
<p><strong>3. Consultas Personalizadas:</strong> Permite escribir consultas personalizadas mediante anotaciones como <strong>@Query</strong>.
También admite la creación de métodos de consulta basados en el nombre del método, como <strong>findByNombre(String nombre)</strong>.</p>
<p><strong>4. Compatibilidad con Múltiples Tecnologías de Bases de Datos:</strong></p>
<ul>
<li>Relacionales: Mediante JPA (Java Persistence API).</li>
<li>NoSQL: MongoDB, Redis, Neo4j, Cassandra, etc.</li>
<li>Buscadores: Elasticsearch, Solr.</li>
</ul>
<p><strong>5. Configuración Declarativa:</strong> Al integrar Spring Data con Spring Boot, se pueden configurar muchas opciones mediante propiedades en <strong>application.properties</strong>, evitando configuraciones manuales detalladas.</p>
<p><strong>6. Integración con Spring Boot:</strong> Con dependencias específicas como <strong>spring-boot-starter-data-jpa</strong> o <strong>spring-boot-starter-data-mongodb</strong>, Spring Data se integra perfectamente con el resto del ecosistema de Spring.</p>
<hr />
<p>En lugar de proporcionar una única solución, Spring Data está compuesto por varios módulos, cada uno diseñado para un tipo concreto de tecnología de persistencia, como bases de datos relacionales, NoSQL o sistemas de búsqueda. Gracias a esta estructura modular, el desarrollador puede cambiar la tecnología de persistencia sin modificar la arquitectura general de la aplicación. Sus principales módulos son:</p>
<ul>
<li><strong>Spring Data JPA:</strong> Proporciona una integración con JPA para bases de datos relacionales. Es ideal para trabajar con entidades Java mapeadas a tablas de bases de datos. JPA es la especificación para persistir, leer y gestionar data desde los objetos Java a la base de datos.</li>
<li><strong>Spring Data MongoDB:</strong> Facilita el acceso a bases de datos MongoDB, una base de datos NoSQL orientada a documentos.</li>
<li><strong>Spring Data Redis:</strong> Para aplicaciones que necesitan interactuar con Redis, una base de datos en memoria.</li>
<li><strong>Spring Data Cassandra:</strong> Proporciona soporte para bases de datos distribuidas como Cassandra.</li>
<li><strong>Spring Data Elasticsearch:</strong> Simplifica las interacciones con Elasticsearch, un motor de búsqueda y análisis.</li>
</ul>
<h3 id="441-spring-data-jpa-bd-relacionales">4.4.1. Spring Data JPA (BD relacionales)<a class="headerlink" href="#441-spring-data-jpa-bd-relacionales" title="Permanent link">&para;</a></h3>
<p>Spring Data JPA (Java Persistence API) es un módulo de Spring Data que sirve para simplificar el acceso a bases de datos relacionales utilizando objetos (clases) sin tener que escribir SQL ni código repetitivo. Con Spring Data JPA:</p>
<ul>
<li>
<p>Solo defines entidades (@Entity)</p>
</li>
<li>
<p>Creas interfaces Repository</p>
</li>
<li>
<p>Spring genera automáticamente el código</p>
</li>
</ul>
<p><span class="mi_h3">Anotaciones JPA</span></p>
<p>Algunas de las anotaciones JPA son las siguientes:</p>
<p><strong>Anotaciones de Mapeo JPA</strong></p>
<ul>
<li><code>@Entity</code> -  Marca una clase como una entidad JPA, mapeada a una tabla en la base de datos.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Entity
data class Planta(
    @Id
    val id: Int,
    val nombre: String,
    val tipo: String,
    val altura: Double
)
</code></pre></div>
<ul>
<li><code>@Table</code> - Especifica el nombre de la tabla que corresponde a la entidad.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Entity
@Table(name = &quot;plantas&quot;)
data class Planta(
    @Id
    var id_planta: Int,  
    val nombre: String,
    val tipo: String,
    val altura: Double
)
</code></pre></div>
<ul>
<li><code>@Id</code> - Indica que un campo es la clave primaria de la tabla.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Id
val id_planta: Int
</code></pre></div>
<ul>
<li><code>@GeneratedValue</code> - Define cómo se genera el valor de la clave primaria (<code>GenerationType.IDENTITY</code>, <code>GenerationType.SEQUENCE</code>, etc.)</li>
</ul>
<div class="highlight"><pre><span></span><code>@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
val id_planta: Int
</code></pre></div>
<ul>
<li><code>@Column</code> - Configura una columna de la tabla, como nombre, si es nula o única.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Column(nombre = &quot;planta_nombre&quot;, nullable = false, unique = true)
val name: String
</code></pre></div>
<ul>
<li><code>@JoinColumn</code> - Especifica la columna que actúa como clave foránea.</li>
</ul>
<div class="highlight"><pre><span></span><code>@ManyToOne
@JoinColumn(name = &quot;id_jardin&quot;)
var jardin: Jardin
</code></pre></div>
<ul>
<li><code>@Lob</code> - Indica que un campo es un objeto de gran tamaño (texto o binario).</li>
</ul>
<div class="highlight"><pre><span></span><code>@Lob
val description: String
</code></pre></div>
<ul>
<li><code>@Transient</code> - Excluye un campo del mapeo de base de datos (no se almacena).</li>
</ul>
<div class="highlight"><pre><span></span><code>@Transient
val calculatedField: String
</code></pre></div>
<p><strong>Anotaciones de relaciones JPA</strong></p>
<ul>
<li><code>@ManyToOne</code>, <code>@OneToMany</code>, <code>@OneToOne</code>, <code>@ManyToMany</code>: Definen relaciones entre entidades.</li>
</ul>
<div class="highlight"><pre><span></span><code>@ManyToOne
val department: Department
</code></pre></div>
<table>
<thead>
<tr>
<th>Anotación</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@ManyToOne</code></td>
<td>Relación muchos a uno</td>
</tr>
<tr>
<td><code>@OneToMany</code></td>
<td>Relación uno a muchos</td>
</tr>
<tr>
<td><code>@OneToOne</code></td>
<td>Relación uno a uno</td>
</tr>
<tr>
<td><code>@ManyToMany</code></td>
<td>Relación muchos a muchos</td>
</tr>
</tbody>
</table>
<p><strong>Anotaciones de Spring Data JPA</strong></p>
<ul>
<li><code>@Repository</code> - Marca una interfaz o clase como repositorio Spring. El <code>_data class_</code> representa la entidad (tabla), mientras que el <code>@Repository</code> se encarga de las operaciones de acceso a datos sobre esa entidad.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Repository
interface PlantaRepository : JpaRepository&lt;Planta, Int&gt;
</code></pre></div>
<ul>
<li><code>@Query</code> y <code>@Param</code> - El primero define una consulta personalizada usando JPQL o SQL nativo y el segundo define parámetros nombrados para consultas con <code>@Query</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code>//Ejemplo (JPQL):
@Query(&quot;SELECT p FROM Planta p WHERE p.nombre = :nombre&quot;)
fun findByNombre(@Param(&quot;nombre&quot;) nombre: String): List&lt;Planta&gt;

//Ejemplo (SQL nativo):
@Query(value = &quot;SELECT * FROM plantas WHERE nombre = :nombre&quot;, nativeQuery = true)
fun findByNombreNative(@Param(&quot;nombre&quot;) nombre: String): List&lt;Planta&gt;
</code></pre></div>
<ul>
<li><code>@Modifying</code> - Se utiliza con consultas <code>@Query</code> para operaciones de actualización o eliminación.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Modifying
@Query(&quot;UPDATE Planta p SET p.nombre = :nombre WHERE p.id_planta = :id_planta&quot;)
fun actualizarNombre(
    @Param(&quot;id_planta&quot;) id_planta: Int,
    @Param(&quot;nombre&quot;) nombre: String
)
</code></pre></div>
<ul>
<li><code>@EnableJpaRepositories</code> - Habilita la funcionalidad de Spring Data JPA y escanea paquetes para detectar repositorios.</li>
</ul>
<div class="highlight"><pre><span></span><code>@EnableJpaRepositories(basePackages = [&quot;com.example.repository&quot;])
</code></pre></div>
<ul>
<li><code>@EntityGraph</code> - Especifica cómo cargar las relaciones en una consulta, evitando lazy loading.</li>
</ul>
<div class="highlight"><pre><span></span><code>//Busca una planta por su nombre y carga la planta + el jardín asociado
@EntityGraph(attributePaths = [&quot;jardin&quot;])
fun findByNombre(nombre: String): Planta?
</code></pre></div>
<p><strong>Anotaciones de Transacciones</strong></p>
<ul>
<li><code>@Transactional</code> - Marca un método o clase para ejecutar dentro de una transacción.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Transactional
fun updatePlantaDetails(planta: Planta) { ... }
</code></pre></div>
<ul>
<li><code>@Rollback</code> - Utilizada para forzar la reversión de una transacción.</li>
</ul>
<div class="highlight"><pre><span></span><code>@Transactional
@Rollback
fun testSavePlanta() { ... }
</code></pre></div>
<p><span class="mi_h3">Consultas utilizando convención de nombres</span></p>
<p>Spring Data JPA permite definir métodos en repositorios siguiendo una convención de nombres específica. Esto simplifica la escritura de consultas comunes sin necesidad de usar JPQL o SQL. Para ello analiza el nombre de los métodos en el repositorio e interpreta su significado para generar consultas automáticamente.</p>
<p>La <strong>convención de nombres</strong> se utiliza:</p>
<ul>
<li>
<p>En consultas sencillas y que no requieren lógica compleja ni múltiples combinaciones.</p>
</li>
<li>
<p>Cuando quieres mantener un código más limpio y directo.</p>
</li>
</ul>
<p>La estructura básica es: <code>findBy + NombreDeCampo + Condición</code> donde:</p>
<ul>
<li>
<p><strong>findBy</strong>: Indica que se busca una entidad en la base de datos. Alternativas: <strong>readBy</strong> (lectura de datos), <strong>queryBy</strong> (consulta de datos) y <strong>getBy</strong> (obtener datos).</p>
</li>
<li>
<p><strong>NombreDeCampo</strong>: Debe coincidir exactamente con el nombre del atributo en la entidad. Se puede incluir navegación de atributos para relaciones (EntidadRelacionada.Atributo).</p>
</li>
<li>
<p><strong>Condición</strong> (opcional): Permite añadir operadores lógicos como And, Or, etc. Ejemplo: findByNombreAndAltura.</p>
</li>
</ul>
<p><strong>Ejemplos de métodos según la convención</strong></p>
<ul>
<li>
<p>Consultas simples: Método <strong>findByNombre(String nombre)</strong>. Ejemplo de consulta generada:</p>
<div class="highlight"><pre><span></span><code>    SELECT * FROM plantas WHERE nombre = ?
</code></pre></div>
</li>
<li>
<p>Consultas con condiciones: Método <strong>findByNombreAndAltura(String nombre, Double altura)</strong>. Ejemplo de consulta generada:</p>
<div class="highlight"><pre><span></span><code>    SELECT * FROM plantas WHERE nombre = ? AND altura = ?
</code></pre></div>
</li>
<li>
<p>Consultas con orden: Método <strong>findByNombreOrderByAlturaDesc(String nombre)</strong>. Ejemplo de consulta generada:</p>
<div class="highlight"><pre><span></span><code>    SELECT * FROM plantas WHERE nombre = ? ORDER BY altura DESC
</code></pre></div>
</li>
<li>
<p>Consultas con relaciones. Si hay una relación entre entidades, se puede navegar por los campos relacionados: Método <strong>findByComarcaNomC(String nomC)</strong>. Ejemplo de consulta generada:</p>
<div class="highlight"><pre><span></span><code>     SELECT * FROM plantas JOIN jardines ON plantas.id_jardin = jardines.id_jardin WHERE plantas.nombre = ?
</code></pre></div>
</li>
</ul>
<p><strong>Palabras clave en la convención</strong></p>
<table>
<thead>
<tr>
<th>Palabra Clave</th>
<th>Función</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>And</code></td>
<td>Combina múltiples condiciones con <code>AND</code></td>
<td><code>findByNombreAndAltura</code></td>
</tr>
<tr>
<td><code>Or</code></td>
<td>Combina múltiples condiciones con <code>OR</code></td>
<td><code>findByNombreOrAltura</code></td>
</tr>
<tr>
<td><code>Between</code></td>
<td>Busca valores en un rango</td>
<td><code>findByAlturaBetween</code></td>
</tr>
<tr>
<td><code>LessThan</code></td>
<td>Busca valores menores a un límite</td>
<td><code>findByAlturaLessThan</code></td>
</tr>
<tr>
<td><code>GreaterThan</code></td>
<td>Busca valores mayores a un límite</td>
<td><code>findByAlturaGreaterThan</code></td>
</tr>
<tr>
<td><code>IsNull</code></td>
<td>Busca valores <code>NULL</code></td>
<td><code>findByTipoIsNull</code></td>
</tr>
<tr>
<td><code>IsNotNull</code></td>
<td>Busca valores que no sean <code>NULL</code></td>
<td><code>findByTipoIsNotNull</code></td>
</tr>
<tr>
<td><code>Like</code></td>
<td>Busca valores que coincidan con un patrón</td>
<td><code>findByNombreLike</code></td>
</tr>
<tr>
<td><code>NotLike</code></td>
<td>Busca valores que no coincidan con un patrón</td>
<td><code>findByNombreNotLike</code></td>
</tr>
<tr>
<td><code>StartingWith</code></td>
<td>Busca valores que comiencen con un prefijo</td>
<td><code>findByNombreStartingWith</code></td>
</tr>
<tr>
<td><code>EndingWith</code></td>
<td>Busca valores que terminen con un sufijo</td>
<td><code>findByNombreEndingWith</code></td>
</tr>
<tr>
<td><code>Containing</code></td>
<td>Busca valores que contengan un patrón</td>
<td><code>findByNombreContaining</code></td>
</tr>
<tr>
<td><code>OrderBy</code></td>
<td>Ordena los resultados por un campo específico</td>
<td><code>findByNombreOrderByAlturaDesc</code></td>
</tr>
<tr>
<td><code>Top</code></td>
<td>Devuelve los primeros resultados (límite)</td>
<td><code>findTop3ByAlturaGreaterThan</code></td>
</tr>
<tr>
<td><code>First</code></td>
<td>Devuelve el primer resultado</td>
<td><code>findFirstByNombre</code></td>
</tr>
</tbody>
</table>
<p>A tener en cuenta:</p>
<ul>
<li>
<p><strong>Coincidencia exacta del nombre del campo</strong>: Los nombres deben coincidir con los atributos definidos en la entidad.</p>
</li>
<li>
<p><strong>Relaciones</strong>: Usa la notación <em>EntidadRelacionada.Atributo</em> para navegar entre tablas relacionadas.</p>
</li>
<li>
<p><strong>Orden</strong>: Los métodos pueden incluir palabras clave de ordenación, como <em>OrderBy</em>.</p>
</li>
<li>
<p><strong>Parámetros</strong>: Los métodos generados reciben parámetros en el mismo orden en que se declaran en el nombre del método.</p>
</li>
</ul>
<p><span class="mis_ejemplos">Ejemplo 4: CRUD con JPA y MySQL</span></p>
<p>En este proyecto vamos a almacenar la información de nuestras plantas en una BD MySQL y utilizar JPA para las operaciones CRUD. Los pasos para desarrollar la aplicación son los siguientes:</p>
<p><span class="mi_sombreado"><strong>PASO 1: Crear el proyecto</strong></span></p>
<p>Creamos un nuevo proyecto llamado <code>plantasMySQL</code> utilizando Spring Initializr. En este caso añadimos la dependencia JPA como se ve en la imagen siguiente:</p>
<p><img alt="Spring 13" src="img/spring/spring13.jpg" /></p>
<p>Hay que tener cuidado si copiamos fragmentos de código del anterior ejemplo ya que habrá que cambiar en los imports <code>com.example.plantasCSV</code> por <code>com.example.plantasMySQL</code></p>
<p><span class="mi_sombreado"><strong>PASO 2: Añadir dependencias y configuración</strong></span></p>
<p>Añadimos las siguientes líneas al archivo <code>pom.xml</code> dentro del bloque <code>&lt;dependencies&gt;</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- MySQL Connector --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.mysql<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>mysql-connector-j<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>Añadimos las siguientes líneas al archivo <code>application.properties</code> sustituyendo <code>BD</code> por el nombre de nuestra base de datos, <code>user</code> por el nombre de usuario y <code>pass</code> por la contraseña (los que creamos al montar el servidor y crear la base de datos):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ===============================</span>
<span class="c1"># DATASOURCE (MySQL)</span>
<span class="c1"># ===============================</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/nom_BD?useSSL=false&amp;allowPublicKeyRetrieval=true</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">user</span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">pass</span>
<span class="na">spring.datasource.driver-class-name</span><span class="o">=</span><span class="s">com.mysql.cj.jdbc.Driver</span>


<span class="c1"># ===============================</span>
<span class="c1"># JPA / HIBERNATE</span>
<span class="c1"># ===============================</span>
<span class="na">spring.jpa.database-platform</span><span class="o">=</span><span class="s">org.hibernate.dialect.MySQLDialect</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">update</span>
<span class="na">spring.jpa.show-sql</span><span class="o">=</span><span class="s">true</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 3: Añadir el modelo</strong></span></p>
<p>Ahora nuestra clase Planta debe ser una entidad JPA. En Kotlin, JPA necesita un constructor vacío, por tanto, debemos asignar valores por defecto a todos los campos de la data class para que Kotlin genere ese constructor automáticamente.</p>
<p>El contenido del archivo <code>src/main/kotlin/com/example/plantasMySQL/model/Planta.kt</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">jakarta.persistence.*</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;plantas&quot;</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Planta</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">nombre</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@Column</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">tipo</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@Column</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">altura</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@Column</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">foto</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 4: Añadir el repositorio</strong></span></p>
<p>El contenido del archivo <code>src/main/kotlin/com/example/plantasMySQL/repository/PlantaRepository.kt</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span>

<span class="nd">@Repository</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">PlantaRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Planta</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="o">&gt;</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 5: Añadir el servicio</strong></span></p>
<p>El código del servicio se simplifica enormemente (ahora llamará a los métodos de PlantaRepository). El contenido del archivo <code>src/main/kotlin/com/example/plantasMySQL/service/PlantaService.kt</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.service</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.repository.PlantaRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.compareTo</span>

<span class="k">import</span><span class="w"> </span><span class="nn">java.io.File</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.collections.map</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.io.readLines</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.text.split</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.text.toDouble</span>


<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaService</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">repository</span><span class="p">:</span><span class="w"> </span><span class="n">PlantaRepository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listarPlantas</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Planta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">buscarPorId</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">Planta? </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardar</span><span class="p">(</span><span class="n">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">):</span><span class="w"> </span><span class="n">Planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">planta</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">borrar</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">repository</span><span class="p">.</span><span class="na">existsById</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>


<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">importarDesdeCSV</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// 1. Verificar si ya hay datos para no duplicar (opcional)</span>
<span class="w">        </span><span class="c1">//if (repository.count() &gt; 0) return</span>

<span class="w">        </span><span class="c1">// 2. Leer el fichero (Lógica del Ejemplo 3)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;src/main/resources/data/plantas.csv&quot;</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;el fichero existe&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantasLeidas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">readLines</span><span class="p">().</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">linea</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">partes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linea</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="c1">// 3. Crear el objeto Planta (Lógica del Ejemplo 4)</span>
<span class="w">                </span><span class="c1">// IMPORTANTE: Ponemos id_planta = null para que se genere uno nuevo</span>
<span class="w">                </span><span class="n">Planta</span><span class="p">(</span>
<span class="w">                    </span><span class="n">id_planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                    </span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="p">,</span>
<span class="w">                    </span><span class="n">tipo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="p">,</span>
<span class="w">                    </span><span class="n">altura</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="p">.</span><span class="na">toDouble</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">foto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partes</span><span class="o">[</span><span class="m">4</span><span class="o">]</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// 4. Guardar todo en la BD de golpe</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">saveAll</span><span class="p">(</span><span class="n">plantasLeidas</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 6: Añadir el controlador</strong></span></p>
<p>El contenido del archivo <code>src/main/kotlin/com/example/plantasMySQL/controller/PlantaController.kt</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.controller</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL.service.PlantaService</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span>

<span class="nd">@Controller</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">PlantaController</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaService</span><span class="p">:</span><span class="w"> </span><span class="n">PlantaService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listar</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;plantas&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">listarPlantas</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/planta/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">detalle</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">buscarPorId</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;errorPlanta&quot;</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;detallePlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/nueva&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">nuevaPlanta</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaVacia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Planta</span><span class="p">(</span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tipo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">altura</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">foto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plantaVacia</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;titulo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nueva Planta&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;formularioPlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/editar/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">editarPlanta</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaService</span><span class="p">.</span><span class="na">buscarPorId</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;planta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;titulo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Editar Planta&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;formularioPlanta&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/plantas/guardar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardarPlanta</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">plantaService</span><span class="p">.</span><span class="na">guardar</span><span class="p">(</span><span class="n">planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/plantas/borrar/{id_planta}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">borrarPlanta</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">id_planta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">plantaService</span><span class="p">.</span><span class="na">borrar</span><span class="p">(</span><span class="n">id_planta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">        // 1. Ruta para mostrar la página de inicio (index.html)</span>
<span class="cm">        @GetMapping(&quot;/&quot;)</span>
<span class="cm">        fun inicio(): String {</span>
<span class="cm">            return &quot;index&quot;</span>
<span class="cm">        }</span>
<span class="cm">    */</span>


<span class="w">    </span><span class="c1">// 2. Ruta para ejecutar la importación</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/importar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">importarDatos</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">plantaService</span><span class="p">.</span><span class="na">importarDesdeCSV</span><span class="p">()</span><span class="w"> </span><span class="c1">// &lt;--- Tienes que crear este método en el Service como hablamos antes</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/plantas&quot;</span><span class="w"> </span><span class="c1">// Al terminar, nos lleva a la lista para ver el resultado</span>
<span class="w">    </span><span class="p">}</span>


<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 7: Añadir las vistas, bootstrap y las imágenes</strong></span></p>
<p>Todos estos archivos los podemos copiar del proyecto del ejemplo anterior, son los siguientes:</p>
<p><img alt="Spring 14" src="img/spring/spring14.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 8: Comprobar y ejecutar</strong></span></p>
<p>Al ejecutar la aplicación <code>PlantaApplication.kt</code>, por primera vez veremos en la consola mensajes de Hibernate: <code>Hibernate: create table plantas (...)</code> que indican que se ha creado la tabla <code>plantas</code> dentro de la base de datos llamada <code>florabotanica.db</code>.</p>
<p>Al abrir <a href="http://localhost:8080/plantas">http://localhost:8080/plantas</a> en el navegador veremos lo siguiente (inicialmente la tabla plantas estará vacía):</p>
<p><img alt="Spring 15" src="img/spring/spring15.jpg" /></p>
<p>Podemos añadir tantas plantas como queramos con el botón <code>Agregar Nueva Planta</code> y comprobar que los datos se guardan en la BD y son persistentes si detenemos la aplicación y la volvemos a arrancar.</p>
<div class="admonition success">
<p class="admonition-title">Prueba y analiza el ejemplo 4</p>
<ol>
<li>Monta un servidor MySQL en Docker.</li>
<li>Crea un proyecto Spring Boot llamado <code>plantasMySQL</code> utilizando Spring Initializr.</li>
<li>Prueba el código del ejemplo, verifica que funciona correctamente y pregunta tus dudas.</li>
</ol>
</div>
<div class="admonition warning">
<p class="admonition-title">Práctica 2: Trabaja en tu aplicación</p>
<ol>
<li>Crea un nuevo proyecto Spring Boot (con el nombre de tu aplicación) utilizando Spring Initializr.</li>
<li>Tu aplicación tendrá una vista principal (index.html) con las opciones siguientes:<ul>
<li>Importar información: Leerá información de un fichero CSV y la guardará en una tabla de una BD MySQL.</li>
<li>CRUD: funcionará como el ejemplo 4 con las operaciones CRUD sobre la BD MySQL.</li>
</ul>
</li>
<li>Modifica el aspecto de tu aplicación aplicando alguna característica de <code>bootstrap</code> para que el resultado quede personalizado a tu gusto.</li>
</ol>
</div>
<p><span class="mi_h3">Consultas utilizando la anotación @Query</span></p>
<p>La anotación <strong>@Query</strong> se utiliza:</p>
<ul>
<li>
<p>En consultas complejas que involucren múltiples tablas, condiciones avanzadas o subconsultas.</p>
</li>
<li>
<p>Si prefieres optimizar manualmente las consultas.</p>
</li>
<li>
<p>Cuando la convención de nombres generaría un nombre de método excesivamente largo.</p>
</li>
</ul>
<p>La estructura básica es:</p>
<div class="highlight"><pre><span></span><code>@Query(&quot;SELECT e FROM EntityName e WHERE e.property = :value&quot;)
fun findByProperty(@Param(&quot;value&quot;) value: String): List&lt;EntityName&gt;
</code></pre></div>
<p>Hay que tener en cuenta que se utiliza JPQL y no SQL</p>
<table>
<thead>
<tr>
<th></th>
<th>JPQL</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pregunta</td>
<td>al modelo de objetos</td>
<td>a la base de datos</td>
</tr>
<tr>
<td>trabaja</td>
<td>con clases y atributos</td>
<td>con tablas y columnas</td>
</tr>
<tr>
<td>utiliza</td>
<td>nombres de entidades y propiedades de las clases</td>
<td>nombres de tablas y columnas</td>
</tr>
</tbody>
</table>
<p>JPQL</p>
<ul>
<li>
<p>Puede navegar por relaciones entre entidades.</p>
</li>
<li>
<p>Utiliza <em>:nombreParametro</em> para parámetros dinámicos.</p>
</li>
</ul>
<p><strong>Ejemplo sencillo:</strong> Devuelve todas las plantas cuyo tipo coincide con el valor indicado.</p>
<div class="highlight"><pre><span></span><code>@Query(&quot;SELECT p FROM Planta p WHERE p.tipo = :tipo&quot;)
fun findByTipo(@Param(&quot;tipo&quot;) tipo: String): List&lt;Planta&gt;
</code></pre></div>
<p><strong>Ejemplo con relaciones:</strong></p>
<p>La consulta para buscar las plantas que están asociadas con un jardín específico (según el ID del jardín proporcionado):</p>
<div class="highlight"><pre><span></span><code>@Query(&quot;&quot;&quot;
    SELECT jp
    FROM JardinPlanta jp
    JOIN jp.planta p
    WHERE jp.jardin.id_jardin = :idJardin
    ORDER BY p.nombre
&quot;&quot;&quot;)
fun obtenerPlantasDeJardin(
    @Param(&quot;idJardin&quot;) idJardin: Int
): List&lt;JardinPlanta&gt;
</code></pre></div>
<p><strong>SELECT: ¿qué se devuelve?</strong></p>
<p><code>SELECT jp</code> (objetos completos y no campos)</p>
<p><strong>FROM: ¿de dónde salen los datos?</strong></p>
<p><code>FROM JardinPlanta jp</code> (de la clase JardinPlanta)</p>
<p>En SQL sería: <code>FROM jardines_plantas jp</code> (de la tabla <code>jardines_plantas</code>)</p>
<p><strong>JOIN: ¿cómo se relacionan los datos?</strong></p>
<p><code>JOIN jp.planta p</code> (se usa la relación que ya existe entre los objetos)</p>
<p>En SQL sería: <code>JOIN plantas p ON jp.id_planta = p.id_planta</code> (se relacionan dos tablas usando claves foráneas)</p>
<p><strong>WHERE: ¿qué se filtra?</strong></p>
<p><code>WHERE jp.jardin.id_jardin = :idJardin</code> (se navega por objetos de la relación → al objeto → a su atributo)</p>
<p>En SQL sería: <code>WHERE jp.id_jardin = :idJardin</code> (se filtra por una columna)</p>
<p><strong>ORDER BY: ¿cómo se ordena?</strong></p>
<p><code>ORDER BY p.nombre</code> (se ordena por un atributo de la entidad)</p>
<p>En SQL sería: <code>ORDER BY p.nombre</code> (por una columna)</p>
<p>Este mismo ejemplo utilizando convención de nombres quedaría así:</p>
<div class="highlight"><pre><span></span><code>@Repository
interface PlantaRepository : JpaRepository&lt;Planta, Int&gt; {
    fun findByJardinIdJardin(
        idJardin: Int
    ): List&lt;Planta&gt;
}
</code></pre></div>
<ul>
<li>
<p><strong>findBy:</strong> Indica que es un método de consulta.</p>
</li>
<li>
<p><strong>findByJardinIdJardin:</strong> Utiliza la convención de nombres para especificar que se desean encontrar plantas basándose en el idJardin del jardín asociado. Los nombres de los parámetros reflejan claramente los campos utilizados en la consulta.</p>
</li>
</ul>
<hr />
<p><span class="mis_ejemplos">Ejemplo 5: Consultas avanzadas con @Query (MySQL)</span></p>
<p>En el ejemplo anterior hemos utilizado <strong>Spring Data JPA</strong> junto con <strong>MySQL</strong> para implementar un CRUD completo apoyándonos en los métodos que ofrece la interfaz <code>JpaRepository</code> y en <strong>consultas generadas automáticamente mediante convención de nombres</strong>.</p>
<p>Este mecanismo es suficiente para consultas sencillas, pero cuando las consultas incluyen <strong>múltiples condiciones</strong>, <strong>ordenaciones</strong>, <strong>actualizaciones directas</strong> o requieren el uso de <strong>SQL nativo</strong>, resulta más adecuado utilizar la anotación <code>@Query</code>.</p>
<p>En esta ampliación se utiliza <code>@Query</code> para realizar consultas avanzadas con SQL nativo sobre nuestra base de datos. Las operaciones <code>UPDATE</code> y <code>DELETE</code> requieren el uso de <strong><code>@Modifying</code></strong> y <strong><code>@Transactional</code></strong>.</p>
<p>Para poder ilustrar la utilización de este tipo de consultas, ampliaremos nuestra aplicación para gestionar las plantas que hay en los jardines. Imagina que a nuestra empresa de jardinería la contratan varios ayuntamienteos que nos piden trabajos del tipo "hay que plantar 2 rosas y 3 pinos en el jardin llamado Tropical" y "hay que plantar 5 rosas y 4 pinos en el jardin llamado Botánico". Para ello ampliaremos con dos tablas más nuestra base de datos y con varios archivos nuestra aplicación. A continuación de describen todos los pasos necesarios:</p>
<p><span class="mi_sombreado"><strong>PASO 1: Crear el proyecto</strong></span></p>
<p>Podemos crear un proyecto nuevo con las mismas dependencias que el del ejemplo anterior y copiar los archivos que tenemos o ampliar el ejemplo anterior directamente.</p>
<p><span class="mi_sombreado"><strong>PASO 2: Añadir los jardines</strong></span></p>
<p>Para añadir la gestión de los jardines debemos añadir a la BD una nueva tabla llamada <code>jardines</code> (insertamos dos registros):</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">jardines</span><span class="w"> </span><span class="p">(</span>
<span class="n">id_jardin</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="n">nombre</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="n">ubicacion</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span>


<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">jardines</span><span class="w"> </span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">ubicacion</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Botánico&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Madrid&#39;</span><span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">jardines</span><span class="w"> </span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">ubicacion</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Valencia&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Luego añadimos a la aplicación los archivos necesarios para las operaciones CRUD sobre los jardines (equivalentes a los que tenemos para las plantas):</p>
<p><img alt="Spring 16" src="img/spring/spring16.jpg" /></p>
<p>Por último añadimos los archivos <code>html</code> (también equivalentes a los que tenemos para las plantas). Si modificamos el archivo de error nos puede servir tanto para plantas como para jardines, su nuevo código es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Error<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5 text-center&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-danger&quot;</span><span class="p">&gt;</span>Error<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>La información que estás buscando no existe.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5&quot;</span><span class="p">&gt;</span>Volver a la pantalla de inicio<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>De forma que los archivos <code>html</code> de nuestra aplicación son los siguientes:</p>
<p><img alt="Spring 17" src="img/spring/spring17.jpg" /></p>
<p><span class="mi_sombreado"><strong>PASO 3: Comprobar jardines</strong></span></p>
<p>Al abrir <a href="http://localhost:8080/jardines">http://localhost:8080/jardines</a> en el navegador veremos lo siguiente:</p>
<p><img alt="Spring 18" src="img/spring/spring18.jpg" /></p>
<p>El funcionamiento es exactamente el mismo que el de las plantas.</p>
<p>Una vez tenemos las plantas y los jardines funcionando de forma independiente vamos a añadir una pantalla a nuestra aplicación para poder llevar plantas a los jardines. Para ello añadimos una nueva tabla a la base de datos con la relación (muchos a muchos) entre jardines y plantas y añadimos los archivos necesarios a nuestra aplicación.</p>
<p><span class="mi_sombreado"><strong>PASO 4: Ampliar la base de datos</strong></span></p>
<p>Añadir la tabla <code>jardines_plantas</code> a la base de datos y hacemos dos inserts (en este caso suponemos que existen los jardines con id 1 y 2 y las plantas con id 1 y 2:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">jardines_plantas</span><span class="w"> </span><span class="p">(</span>
<span class="n">id_jardin</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="n">id_planta</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="n">cantidad</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id_jardin</span><span class="p">,</span><span class="w"> </span><span class="n">id_planta</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">jardines_plantas</span><span class="w"> </span><span class="p">(</span><span class="n">id_jardin</span><span class="p">,</span><span class="w"> </span><span class="n">id_planta</span><span class="p">,</span><span class="w"> </span><span class="n">cantidad</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">jardines_plantas</span><span class="w"> </span><span class="p">(</span><span class="n">id_jardin</span><span class="p">,</span><span class="w"> </span><span class="n">id_planta</span><span class="p">,</span><span class="w"> </span><span class="n">cantidad</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 5: Añadir el modelo</strong></span></p>
<p>En este caso el modelo es un poco más complejo ya que necesita tener configurada la relación muchos a muchos entre las plantas y los jardines. Creamos el archivo <code>JardinPlanta.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantasMySQL2/model/</code> con el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">jakarta.persistence.*</span>

<span class="nd">@Embeddable</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">JardinPlantaId</span><span class="p">(</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">idPlanta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="p">)</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jardines_plantas&quot;</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">JardinPlanta</span><span class="p">(</span>

<span class="w">    </span><span class="nd">@EmbeddedId</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="n">JardinPlantaId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JardinPlantaId</span><span class="p">(),</span>

<span class="w">    </span><span class="nd">@ManyToOne</span>
<span class="w">    </span><span class="nd">@MapsId</span><span class="p">(</span><span class="s">&quot;idJardin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_jardin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">jardin</span><span class="p">:</span><span class="w"> </span><span class="n">Jardin? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@ManyToOne</span>
<span class="w">    </span><span class="nd">@MapsId</span><span class="p">(</span><span class="s">&quot;idPlanta&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_planta&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">planta</span><span class="p">:</span><span class="w"> </span><span class="n">Planta? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">cantidad</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="p">)</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 6: Añadir el repositorio</strong></span></p>
<p>De momento el repositorio no contendrá código, lo ampliaremos más adelante, ahora creamos el archivo <code>JardinPlantaRepository.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantasMySQL2/repository/</code> con el código siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.JardinPlanta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.JardinPlantaId</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.Query</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.query.Param</span>


<span class="nd">@Repository</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">JardinPlantaRepository</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">JardinPlanta</span><span class="p">,</span><span class="w"> </span><span class="n">JardinPlantaId</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 7: Añadir la clase del servicio intermedio</strong></span></p>
<p>Crear el archivo <code>JardinPlantaService.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantasMySQL2/service/</code> con el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.service</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.JardinPlanta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.JardinPlantaId</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.Jardin</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.repository.JardinPlantaRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.repository.PlantaRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.repository.JardinRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span>

<span class="nd">@Service</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">JardinPlantaService</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">jardinPlantaRepository</span><span class="p">:</span><span class="w"> </span><span class="n">JardinPlantaRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">jardinRepository</span><span class="p">:</span><span class="w"> </span><span class="n">JardinRepository</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaRepository</span><span class="p">:</span><span class="w"> </span><span class="n">PlantaRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listarTodas</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JardinPlanta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">jardinPlantaRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Métodos para llenar los desplegables</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listarJardines</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Jardin</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jardinRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listarPlantas</span><span class="p">():</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Planta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Método para guardar</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardar</span><span class="p">(</span><span class="n">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">idPlanta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">cantidad</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Buscamos las entidades (lanzará error si no existen, lo cual es bueno para integridad)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">jardinRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jardinRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">idJardin</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">()</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">plantaRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">idPlanta</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">()</span>

<span class="w">        </span><span class="c1">// 2. Creamos la clave compuesta</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JardinPlantaId</span><span class="p">(</span><span class="n">idJardin</span><span class="p">,</span><span class="w"> </span><span class="n">idPlanta</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 3. Creamos la entidad relación</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">nuevaRelacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JardinPlanta</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">jardin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jardinRef</span><span class="p">,</span>
<span class="w">            </span><span class="n">planta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plantaRef</span><span class="p">,</span>
<span class="w">            </span><span class="n">cantidad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cantidad</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">jardinPlantaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">nuevaRelacion</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 8: Añadir el controlador</strong></span></p>
<p>Crear el archivo <code>JardinPlantaController.kt</code> dentro de la carpeta <code>src/main/kotlin/com/example/plantasMySQL2/controller/</code> con el siguiente código:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.controller</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.JardinPlanta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.model.Planta</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.plantasMySQL2.service.JardinPlantaService</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span>

<span class="c1">// Clase auxiliar para capturar los datos del formulario</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">JardinPlantaForm</span><span class="p">(</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">idPlanta</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">cantidad</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="p">)</span>

<span class="nd">@Controller</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">JardinPlantaController</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">jardinPlantaService</span><span class="p">:</span><span class="w"> </span><span class="n">JardinPlantaService</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/jp&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">listaPlantasJardines</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">relaciones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jardinPlantaService</span><span class="p">.</span><span class="na">listarTodas</span><span class="p">()</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;relaciones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">relaciones</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;jp&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Mostrar el formulario (GET)</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/jp/add&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">mostrarFormulario</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Pasamos un objeto vacío para el binding del formulario</span>
<span class="w">       </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;form&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">JardinPlantaForm</span><span class="p">())</span>

<span class="w">        </span><span class="c1">// Pasamos las listas para los desplegables</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;jardines&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jardinPlantaService</span><span class="p">.</span><span class="na">listarJardines</span><span class="p">())</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;plantas&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jardinPlantaService</span><span class="p">.</span><span class="na">listarPlantas</span><span class="p">())</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;jpForm&quot;</span><span class="w"> </span><span class="c1">// Nombre del archivo HTML nuevo</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Procesar el formulario (POST)</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/jp/guardar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">guardarRelacion</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;form&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">form</span><span class="p">:</span><span class="w"> </span><span class="n">JardinPlantaForm</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">jardinPlantaService</span><span class="p">.</span><span class="na">guardar</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">idJardin</span><span class="p">,</span><span class="w"> </span><span class="n">form</span><span class="p">.</span><span class="na">idPlanta</span><span class="p">,</span><span class="w"> </span><span class="n">form</span><span class="p">.</span><span class="na">cantidad</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/jp&quot;</span><span class="w"> </span><span class="c1">// Redirige a la lista principal</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 9: Añadir las vistas</strong></span></p>
<p>En este caso añadiremos dos vistas, la primera mostrará una lista con los nombres de los jardines, los nombres de las plantas que tienen y la cantidad de éstas en el jardín. La segunda vista será un formulario para añadir una planta a un jardín de forma que si no existe la relación en la base de datos se añadirá un registro y si existe se actualizará la cantidad. </p>
<p>El código del archivo <code>jp.html</code> dentro de la carpeta <code>src/main/resources/templates/</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Informe Plantas por Jardín<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Ubicación de plantas en jardines<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${relaciones.size() &gt; 0}&quot;</span><span class="p">&gt;</span>
        Plantas, jardines y cantidades
    <span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:unless</span><span class="o">=</span><span class="s">&quot;${relaciones.size() &gt; 0}&quot;</span><span class="p">&gt;</span>
        No hay datos para mostrar
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped mt-4&quot;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${relaciones.size() &gt; 0}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Planta<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Jardín<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Cantidad<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;jp : ${relaciones}&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jp.planta.nombre}&quot;</span><span class="p">&gt;</span>Rosa<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jp.jardin.nombre}&quot;</span><span class="p">&gt;</span>Jardín Botánico<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jp.cantidad}&quot;</span><span class="p">&gt;</span>5<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/jp/add}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary btn-lg&quot;</span><span class="p">&gt;</span>Agregar planta a jardín<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-5&quot;</span><span class="p">&gt;</span>Volver a la pantalla de inicio<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>El código del archivo <code>jpForm.html</code> dentro de la carpeta <code>src/main/resources/templates/</code> es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Asignar Planta a Jardín<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/jp/guardar}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${form}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;jardin&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Selecciona el Jardín:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-select&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&quot;jardin&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;idJardin&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">disabled</span> <span class="na">selected</span><span class="p">&gt;</span>-- Elegir Jardín --<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;jardin : ${jardines}&quot;</span>
                        <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${jardin.id_jardin}&quot;</span>
                        <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jardin.nombre}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;planta&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Selecciona la Planta:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-select&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;planta&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;idPlanta&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">disabled</span> <span class="na">selected</span><span class="p">&gt;</span>-- Elegir Planta --<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;planta : ${plantas}&quot;</span>
                        <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${planta.id_planta}&quot;</span>
                        <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${planta.nombre}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;cantidad&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Cantidad:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;cantidad&quot;</span>
                   <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{cantidad}&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">required</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;d-grid gap-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success&quot;</span><span class="p">&gt;</span>Guardar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/jp}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Cancelar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p><span class="mi_sombreado"><strong>PASO 10: Consulta @Query</strong></span></p>
<p>En este último paso, añadiremos una nueva pantalla que devolverá las plantas (y sus cantidades) que hay en un jardín concreto. Para ello, añadimeros un botón a la pantalla de <code>Ubicación de plantas en jardines</code> que nos llevará a una pantalla con un desplegable para elegir el jardín. La consulta se realizará utilizando <code>@Query</code>. A continuación se muestra el código nuevo:</p>
<ul>
<li>En el archivo <code>jp.html</code> añimos el código para el nuevo botón:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/informe/plantas-por-jardin}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary mt-3&quot;</span><span class="p">&gt;</span>
    Filtrar por jardín <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>En <code>JardinPlantaController.kt</code> añadimos el código del formulario y del resultado de la búsqueda:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="c1">// Mostrar el formulario con el desplegable</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/jp/plantas-por-jardin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">formularioPlantasPorJardin</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;jardines&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jardinService</span><span class="p">.</span><span class="na">listar</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;plantasPorJardinForm&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Procesar el jardín seleccionado</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/jp/plantas-por-jardin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">mostrarPlantasDeJardin</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">Model</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">relaciones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jardinPlantaService</span><span class="p">.</span><span class="na">obtenerPlantasDeJardin</span><span class="p">(</span><span class="n">idJardin</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;relaciones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">relaciones</span><span class="p">)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;jardines&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jardinService</span><span class="p">.</span><span class="na">listar</span><span class="p">())</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;idJardinSeleccionado&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">idJardin</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;plantasPorJardinForm&quot;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ul>
<li>En <code>JardinPlantaRepository.kt</code> añadimos la consulta:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT jp</span>
<span class="s">        FROM JardinPlanta jp</span>
<span class="s">        JOIN jp.planta p</span>
<span class="s">        WHERE jp.jardin.id_jardin = :idJardin</span>
<span class="s">        ORDER BY p.nombre</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">obtenerPlantasDeJardin</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;idJardin&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JardinPlanta</span><span class="o">&gt;</span>
</code></pre></div>
<ul>
<li>En <code>JardinPlantaService.kt</code> añadimos el código que llama a la consulta:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">obtenerPlantasDeJardin</span><span class="p">(</span><span class="n">idJardin</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JardinPlanta</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">jardinPlantaRepository</span><span class="p">.</span><span class="na">obtenerPlantasDeJardin</span><span class="p">(</span><span class="n">idJardin</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Creamos la vista <code>plantasPorJardinForm.html</code> con el formuario y el resultado de la consulta:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Plantas por jardín<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/bootstrap/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-5&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Plantas por jardín<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/jp/plantas-por-jardin}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row g-3 mb-4&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-6&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Selecciona un jardín:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;idJardin&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-select&quot;</span> <span class="na">required</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>-- Selecciona --<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;j : ${jardines}&quot;</span>
                        <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${j.id_jardin}&quot;</span>
                        <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${j.nombre}&quot;</span>
                        <span class="na">th:selected</span><span class="o">=</span><span class="s">&quot;${j.id_jardin == idJardinSeleccionado}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-6 align-self-end&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success&quot;</span><span class="p">&gt;</span>
                Mostrar plantas
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped&quot;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${relaciones != null}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Planta<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Cantidad<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;jp : ${relaciones}&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jp.planta.nombre}&quot;</span><span class="p">&gt;</span>Rosa<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${jp.cantidad}&quot;</span><span class="p">&gt;</span>5<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/jp}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="p">&gt;</span>Volver<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<div class="admonition success">
<p class="admonition-title">Prueba y analiza el ejemplo 5</p>
<ol>
<li>Crea un proyecto Spring Boot llamado <code>plantasMySQL2</code> utilizando Spring Initializr.</li>
<li>Prueba el código del ejemplo, verifica que funciona correctamente y pregunta tus dudas.</li>
</ol>
</div>
<div class="admonition warning">
<p class="admonition-title">Práctica 3: Amplía tu aplicación</p>
<p>Amplía tu aplicación para que cumpla:</p>
<ol>
<li>
<p>Tener dos tablas independientes y una tercera tabla que las relaciones de muchos a muchos.</p>
</li>
<li>
<p>CRUD de las 3 tablas.</p>
</li>
<li>
<p>Pantalla que funcione de forma similar a la del ejemplo utilizando una consulta @Query</p>
</li>
</ol>
</div>
<div class="admonition danger">
<p class="admonition-title">Entrega</p>
<p>Realiza lo siguiente:</p>
<ol>
<li>
<p>Exporta tu BD a un archivo .sql</p>
</li>
<li>
<p>Comprime la caarpeta <code>main</code> de tu proyecto en formato .zip</p>
</li>
<li>
<p>Entrega en Aules el archivo .sql y el archivo .zip</p>
</li>
</ol>
<p><strong>IMPORTANTE</strong>: El proyecto no debe contener código que no se utilice, ni restos de pruebas de los ejemplos y no debe estar separado por prácticas. Debe ser un proyecto totalmente funcional.</p>
</div>
<!--

### 4.4.2. Spring Data MongoDB


<span class="mi_h3">Spring Data MongoDB</span>

-->

<hr />
<p><span class="mi_h3">Autoría</span></p>
<p>Obra realizada por Begoña Paterna Lluch basada en materiales desarrollados por Alicia Salvador Contreras. Publicada bajo licencia <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Atribución/Reconocimiento-CompartirIgual 4.0 Internacional</a></p>
<hr />












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["content.code.copy", "content.tabs.link", "navigation.instant", "navigation.top", "navigation.sections", "search.highlight", "search.suggest", "toc.integrate"], "search": "assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>